<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 12">
<meta name=Originator content="Microsoft Word 12">
<link rel=File-List href="nginx/filelist.xml">
<link rel=Edit-Time-Data href="nginx/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>edward</o:Author>
  <o:LastAuthor>Administrator</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>4064</o:TotalTime>
  <o:LastPrinted>2015-07-11T02:40:00Z</o:LastPrinted>
  <o:Created>2015-07-11T02:44:00Z</o:Created>
  <o:LastSaved>2015-07-11T02:44:00Z</o:LastSaved>
  <o:Pages>68</o:Pages>
  <o:Words>7116</o:Words>
  <o:Characters>40567</o:Characters>
  <o:Lines>338</o:Lines>
  <o:Paragraphs>95</o:Paragraphs>
  <o:CharactersWithSpaces>47588</o:CharactersWithSpaces>
  <o:Version>12.00</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:RelyOnVML/>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]-->
<link rel=themeData href="nginx/themedata.thmx">
<link rel=colorSchemeMapping href="nginx/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 磅</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>ZH-CN</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
   <w:UseFELayout/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-536859905 -1073711037 9 0 511 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 680460288 22 0 262145 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-536870145 1073743103 0 0 415 0;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520092929 1073786111 9 0 415 0;}
@font-face
	{font-family:微软雅黑;
	panose-1:2 11 5 3 2 2 4 2 2 4;
	mso-font-charset:134;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-2147483001 672087122 22 0 262175 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520081665 -1073717157 41 0 66047 0;}
@font-face
	{font-family:"Lucida Console";
	panose-1:2 11 6 9 4 5 4 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-pitch:fixed;
	mso-font-signature:-2147482993 6144 0 0 31 0;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-pitch:fixed;
	mso-font-signature:-520092929 1073806591 9 0 415 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1593833729 1073750107 16 0 415 0;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 680460288 22 0 262145 0;}
@font-face
	{font-family:"\@微软雅黑";
	panose-1:2 11 5 3 2 2 4 2 2 4;
	mso-font-charset:134;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-2147483001 672087122 22 0 262175 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
h1
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"标题 1 Char";
	mso-style-next:正文;
	margin-top:17.0pt;
	margin-right:0cm;
	margin-bottom:16.5pt;
	margin-left:21.6pt;
	text-indent:-21.6pt;
	line-height:240%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:1;
	mso-list:l11 level1 lfo1;
	font-size:22.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:22.0pt;
	font-weight:bold;}
h2
	{mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 2 Char";
	mso-style-next:正文;
	margin-top:13.0pt;
	margin-right:0cm;
	margin-bottom:13.0pt;
	margin-left:28.8pt;
	text-indent:-28.8pt;
	line-height:173%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:2;
	mso-list:l11 level2 lfo1;
	font-size:16.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	font-weight:bold;}
h3
	{mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 3 Char";
	mso-style-next:正文;
	margin-top:13.0pt;
	margin-right:0cm;
	margin-bottom:13.0pt;
	margin-left:36.0pt;
	text-indent:-36.0pt;
	line-height:173%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:3;
	mso-list:l11 level3 lfo1;
	font-size:16.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;
	font-weight:bold;}
h4
	{mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 4 Char";
	mso-style-next:正文;
	margin-top:14.0pt;
	margin-right:0cm;
	margin-bottom:14.5pt;
	margin-left:43.2pt;
	text-indent:-43.2pt;
	line-height:156%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:4;
	mso-list:l11 level4 lfo1;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	font-weight:bold;}
h5
	{mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 5 Char";
	mso-style-next:正文;
	margin-top:14.0pt;
	margin-right:0cm;
	margin-bottom:14.5pt;
	margin-left:50.4pt;
	text-indent:-50.4pt;
	line-height:156%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:5;
	mso-list:l11 level5 lfo1;
	font-size:14.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;
	font-weight:bold;}
h6
	{mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 6 Char";
	mso-style-next:正文;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.2pt;
	margin-left:57.6pt;
	text-indent:-57.6pt;
	line-height:133%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:6;
	mso-list:l11 level6 lfo1;
	font-size:12.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	font-weight:bold;}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 7 Char";
	mso-style-next:正文;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.2pt;
	margin-left:64.8pt;
	text-indent:-64.8pt;
	line-height:133%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:7;
	mso-list:l11 level7 lfo1;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;
	font-weight:bold;}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 8 Char";
	mso-style-next:正文;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.2pt;
	margin-left:72.0pt;
	text-indent:-72.0pt;
	line-height:133%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:8;
	mso-list:l11 level8 lfo1;
	font-size:12.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;}
p.MsoHeading9, li.MsoHeading9, div.MsoHeading9
	{mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"标题 9 Char";
	mso-style-next:正文;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.2pt;
	margin-left:79.2pt;
	text-indent:-79.2pt;
	line-height:133%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:9;
	mso-list:l11 level9 lfo1;
	font-size:10.5pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-priority:99;
	mso-style-link:"页眉 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	layout-grid-mode:char;
	border:none;
	mso-border-bottom-alt:solid windowtext .75pt;
	padding:0cm;
	mso-padding-alt:0cm 0cm 1.0pt 0cm;
	font-size:9.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-priority:99;
	mso-style-link:"页脚 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:center 207.65pt right 415.3pt;
	layout-grid-mode:char;
	font-size:9.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-priority:10;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"标题 Char";
	mso-style-next:正文;
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	text-align:center;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	font-weight:bold;}
a:link, span.MsoHyperlink
	{mso-style-priority:99;
	mso-style-parent:"";
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-noshow:yes;
	mso-style-priority:99;
	color:purple;
	mso-themecolor:followedhyperlink;
	text-decoration:underline;
	text-underline:single;}
p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"文档结构图 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:9.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
p
	{mso-style-priority:99;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
code
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-ansi-font-size:12.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;}
pre
	{mso-style-priority:99;
	mso-style-link:"HTML 预设格式 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"批注框文本 Char";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:9.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-priority:34;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	margin:0cm;
	margin-bottom:.0001pt;
	text-indent:21.0pt;
	mso-char-indent-count:2.0;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
span.Char
	{mso-style-name:"文档结构图 Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:文档结构图;
	mso-ansi-font-size:9.0pt;
	mso-bidi-font-size:9.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;}
span.1Char
	{mso-style-name:"标题 1 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 1";
	mso-ansi-font-size:22.0pt;
	mso-bidi-font-size:22.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:22.0pt;
	font-weight:bold;}
span.Char0
	{mso-style-name:"批注框文本 Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:批注框文本;
	mso-ansi-font-size:9.0pt;
	mso-bidi-font-size:9.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;}
span.Char1
	{mso-style-name:"页眉 Char";
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:页眉;
	mso-ansi-font-size:9.0pt;
	mso-bidi-font-size:9.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;}
span.Char2
	{mso-style-name:"页脚 Char";
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:页脚;
	mso-ansi-font-size:9.0pt;
	mso-bidi-font-size:9.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;}
span.2Char
	{mso-style-name:"标题 2 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 2";
	mso-ansi-font-size:16.0pt;
	mso-bidi-font-size:16.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.3Char
	{mso-style-name:"标题 3 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 3";
	mso-ansi-font-size:16.0pt;
	mso-bidi-font-size:16.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.4Char
	{mso-style-name:"标题 4 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 4";
	mso-ansi-font-size:14.0pt;
	mso-bidi-font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.5Char
	{mso-style-name:"标题 5 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 5";
	mso-ansi-font-size:14.0pt;
	mso-bidi-font-size:14.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.6Char
	{mso-style-name:"标题 6 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 6";
	mso-ansi-font-size:12.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.7Char
	{mso-style-name:"标题 7 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 7";
	mso-ansi-font-size:12.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.8Char
	{mso-style-name:"标题 8 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 8";
	mso-ansi-font-size:12.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	mso-font-kerning:0pt;}
span.9Char
	{mso-style-name:"标题 9 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"标题 9";
	mso-bidi-font-size:10.5pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-fareast-theme-font:major-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	mso-font-kerning:0pt;}
span.tcnt
	{mso-style-name:tcnt;
	mso-style-unhide:no;}
p.tdep, li.tdep, div.tdep
	{mso-style-name:tdep;
	mso-style-unhide:no;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
span.pleft
	{mso-style-name:pleft;
	mso-style-unhide:no;}
span.blogsep
	{mso-style-name:blogsep;
	mso-style-unhide:no;}
span.apple-converted-space
	{mso-style-name:apple-converted-space;
	mso-style-unhide:no;}
span.pright
	{mso-style-name:pright;
	mso-style-unhide:no;}
span.zihao
	{mso-style-name:zihao;
	mso-style-unhide:no;}
span.iblock
	{mso-style-name:iblock;
	mso-style-unhide:no;}
span.HTMLChar
	{mso-style-name:"HTML 预设格式 Char";
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"HTML 预设格式";
	mso-ansi-font-size:12.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:宋体;
	mso-ascii-font-family:宋体;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:宋体;
	mso-bidi-font-family:宋体;
	mso-font-kerning:0pt;}
span.mw-headline
	{mso-style-name:mw-headline;
	mso-style-unhide:no;}
span.attribute
	{mso-style-name:attribute;
	mso-style-unhide:no;}
span.attribute-value
	{mso-style-name:attribute-value;
	mso-style-unhide:no;}
span.linktitle
	{mso-style-name:link_title;
	mso-style-unhide:no;}
span.string
	{mso-style-name:string;
	mso-style-unhide:no;}
span.pln
	{mso-style-name:pln;
	mso-style-unhide:no;}
span.pun
	{mso-style-name:pun;
	mso-style-unhide:no;}
span.typ
	{mso-style-name:typ;
	mso-style-unhide:no;}
span.lit
	{mso-style-name:lit;
	mso-style-unhide:no;}
span.fc07
	{mso-style-name:fc07;
	mso-style-unhide:no;}
span.sep
	{mso-style-name:sep;
	mso-style-unhide:no;}
span.nas-itm
	{mso-style-name:nas-itm;
	mso-style-unhide:no;}
span.f-mylikeicons
	{mso-style-name:f-mylikeicons;
	mso-style-unhide:no;}
span.ilft
	{mso-style-name:ilft;
	mso-style-unhide:no;}
span.irgt
	{mso-style-name:irgt;
	mso-style-unhide:no;}
span.ul
	{mso-style-name:ul;
	mso-style-unhide:no;}
span.m2a
	{mso-style-name:m2a;
	mso-style-unhide:no;}
span.fc05
	{mso-style-name:fc05;
	mso-style-unhide:no;}
span.zfce
	{mso-style-name:zfce;
	mso-style-unhide:no;}
span.p
	{mso-style-name:p;
	mso-style-unhide:no;}
span.fc08
	{mso-style-name:fc08;
	mso-style-unhide:no;}
p.fc081, li.fc081, div.fc081
	{mso-style-name:fc081;
	mso-style-unhide:no;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
span.z-Char
	{mso-style-name:"z-窗体顶端 Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:z-窗体顶端;
	mso-ansi-font-size:8.0pt;
	mso-bidi-font-size:8.0pt;
	font-family:"Arial","sans-serif";
	mso-ascii-font-family:Arial;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:Arial;
	mso-bidi-font-family:Arial;
	display:none;
	mso-hide:all;
	mso-font-kerning:0pt;}
span.z-Char0
	{mso-style-name:"z-窗体底端 Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:z-窗体底端;
	mso-ansi-font-size:8.0pt;
	mso-bidi-font-size:8.0pt;
	font-family:"Arial","sans-serif";
	mso-ascii-font-family:Arial;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:Arial;
	mso-bidi-font-family:Arial;
	display:none;
	mso-hide:all;
	mso-font-kerning:0pt;}
span.Char3
	{mso-style-name:"标题 Char";
	mso-style-priority:10;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:标题;
	mso-ansi-font-size:16.0pt;
	mso-bidi-font-size:16.0pt;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:major-latin;
	mso-fareast-font-family:宋体;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:major-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:major-bidi;
	mso-font-kerning:0pt;
	font-weight:bold;}
span.com
	{mso-style-name:com;
	mso-style-unhide:no;}
span.str
	{mso-style-name:str;
	mso-style-unhide:no;}
span.kwd
	{mso-style-name:kwd;
	mso-style-unhide:no;}
span.icon
	{mso-style-name:icon;
	mso-style-unhide:no;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;}
 /* Page Definitions */
 @page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;
	mso-footnote-separator:url("nginx/header.htm") fs;
	mso-footnote-continuation-separator:url("nginx/header.htm") fcs;
	mso-endnote-separator:url("nginx/header.htm") es;
	mso-endnote-continuation-separator:url("nginx/header.htm") ecs;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;
	layout-grid:15.6pt;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 @list l0
	{mso-list-id:85345864;
	mso-list-type:hybrid;
	mso-list-template-ids:-1729748850 -177416428 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l1
	{mso-list-id:125004345;
	mso-list-type:hybrid;
	mso-list-template-ids:-1843760310 -1488006512 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l2
	{mso-list-id:164517300;
	mso-list-template-ids:781621878;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l3
	{mso-list-id:240872729;
	mso-list-template-ids:1611854318;}
@list l3:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l4
	{mso-list-id:819922368;
	mso-list-type:hybrid;
	mso-list-template-ids:804444948 1633070896 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l4:level1
	{mso-level-text:%1．;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l5
	{mso-list-id:976956480;
	mso-list-type:hybrid;
	mso-list-template-ids:1208931032 2039484544 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l5:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l6
	{mso-list-id:1148088152;
	mso-list-type:hybrid;
	mso-list-template-ids:1815609348 -968881742 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l6:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l7
	{mso-list-id:1158307902;
	mso-list-type:hybrid;
	mso-list-template-ids:-121217636 -366288996 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l7:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l8
	{mso-list-id:1218316404;
	mso-list-type:hybrid;
	mso-list-template-ids:1611854318 -903047604 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l8:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l9
	{mso-list-id:1221209623;
	mso-list-type:hybrid;
	mso-list-template-ids:163600470 474888054 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l9:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l10
	{mso-list-id:1265961989;
	mso-list-type:hybrid;
	mso-list-template-ids:-167713360 1769512916 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l10:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:30.0pt;
	text-indent:-18.0pt;}
@list l11
	{mso-list-id:1373844434;
	mso-list-template-ids:1159350050;}
@list l11:level1
	{mso-level-style-link:"标题 1";
	mso-level-text:%1;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:21.6pt;
	text-indent:-21.6pt;}
@list l11:level2
	{mso-level-style-link:"标题 2";
	mso-level-text:"%1\.%2";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:28.8pt;
	text-indent:-28.8pt;}
@list l11:level3
	{mso-level-style-link:"标题 3";
	mso-level-text:"%1\.%2\.%3";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:36.0pt;
	text-indent:-36.0pt;}
@list l11:level4
	{mso-level-style-link:"标题 4";
	mso-level-text:"%1\.%2\.%3\.%4";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:43.2pt;
	text-indent:-43.2pt;}
@list l11:level5
	{mso-level-style-link:"标题 5";
	mso-level-text:"%1\.%2\.%3\.%4\.%5";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:50.4pt;
	text-indent:-50.4pt;}
@list l11:level6
	{mso-level-style-link:"标题 6";
	mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:57.6pt;
	text-indent:-57.6pt;}
@list l11:level7
	{mso-level-style-link:"标题 7";
	mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:64.8pt;
	text-indent:-64.8pt;}
@list l11:level8
	{mso-level-style-link:"标题 8";
	mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:72.0pt;
	text-indent:-72.0pt;}
@list l11:level9
	{mso-level-style-link:"标题 9";
	mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:79.2pt;
	text-indent:-79.2pt;}
@list l12
	{mso-list-id:1415277277;
	mso-list-type:hybrid;
	mso-list-template-ids:-1528630452 -1321705970 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l12:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l13
	{mso-list-id:1474248956;
	mso-list-type:hybrid;
	mso-list-template-ids:2051572000 1505105890 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l13:level1
	{mso-level-text:%1．;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l14
	{mso-list-id:1611473697;
	mso-list-template-ids:-484528636;}
@list l15
	{mso-list-id:1625888935;
	mso-list-template-ids:-1528630452;}
@list l15:level1
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l16
	{mso-list-id:1747150308;
	mso-list-template-ids:67698717;}
@list l16:level1
	{mso-level-text:%1;
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:21.25pt;
	text-indent:-21.25pt;}
@list l16:level2
	{mso-level-text:"%1\.%2";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:49.6pt;
	text-indent:-1.0cm;}
@list l16:level3
	{mso-level-text:"%1\.%2\.%3";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:70.9pt;
	text-indent:-1.0cm;}
@list l16:level4
	{mso-level-text:"%1\.%2\.%3\.%4";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:99.2pt;
	text-indent:-35.4pt;}
@list l16:level5
	{mso-level-text:"%1\.%2\.%3\.%4\.%5";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:127.55pt;
	text-indent:-42.5pt;}
@list l16:level6
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:163.0pt;
	text-indent:-2.0cm;}
@list l16:level7
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:191.35pt;
	text-indent:-63.8pt;}
@list l16:level8
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:219.7pt;
	text-indent:-70.9pt;}
@list l16:level9
	{mso-level-text:"%1\.%2\.%3\.%4\.%5\.%6\.%7\.%8\.%9";
	mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:255.1pt;
	text-indent:-85.0pt;}
@list l17
	{mso-list-id:1843885659;
	mso-list-type:hybrid;
	mso-list-template-ids:-1726575972 -1489701272 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l17:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l18
	{mso-list-id:1940021997;
	mso-list-type:hybrid;
	mso-list-template-ids:-1596834922 2006238220 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l18:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l19
	{mso-list-id:1956788811;
	mso-list-type:hybrid;
	mso-list-template-ids:432810690 738381070 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l19:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l20
	{mso-list-id:1969045442;
	mso-list-type:hybrid;
	mso-list-template-ids:1513901336 -2047035640 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l20:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l21
	{mso-list-id:2053191393;
	mso-list-type:hybrid;
	mso-list-template-ids:718019778 -674570780 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l21:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
@list l22
	{mso-list-id:2103186859;
	mso-list-type:hybrid;
	mso-list-template-ids:432718910 -915611734 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l22:level1
	{mso-level-tab-stop:none;
	mso-level-number-position:left;
	margin-left:18.0pt;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:普通表格;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-qformat:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
table.MsoTableGrid
	{mso-style-name:网格型;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-priority:59;
	mso-style-unhide:no;
	border:solid windowtext 1.0pt;
	mso-border-alt:solid windowtext .5pt;
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-border-insideh:.5pt solid windowtext;
	mso-border-insidev:.5pt solid windowtext;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.5pt;
	mso-bidi-font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-bidi-font-family:"Times New Roman";
	mso-bidi-theme-font:minor-bidi;
	mso-font-kerning:1.0pt;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="5122"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=ZH-CN link=blue vlink=purple style='tab-interval:21.0pt;text-justify-trim:
punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p class=MsoNormal align=center style='text-align:center'><span lang=EN-US
style='font-size:26.0pt'>Nginx</span><span style='font-size:26.0pt'>实践</span><span
lang=EN-US style='font-size:26.0pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
major-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:major-fareast'><o:p></o:p></span></p>

<h1><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]>介绍</h1>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>1.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>功能</span></h2>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'><span
lang=EN-US>nginx [engine x]</span>是<span lang=EN-US><a
href="http://sysoev.ru/en/">Igor Sysoev</a></span>编写的一个<span lang=EN-US>HTTP</span>和反向代理服务器，另外它也可以作为邮件代理服务器。
<span style='mso-spacerun:yes'>&nbsp;</span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>1.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>优势</span></h2>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
9.0pt;margin-left:21.25pt;text-indent:-21.25pt;mso-char-indent-count:0;
line-height:21.0pt;mso-list:l16 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:宋体;mso-bidi-theme-font:
minor-fareast;color:#333333'><span style='mso-list:Ignore'>1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;color:#333333'>可以高并发连接：官方测试<span lang=EN-US>Nginx</span>能够支撑<span
lang=EN-US>5</span>万并发连接，在实际生产环境中可支持<span lang=EN-US>2</span>～<span lang=EN-US>4</span>万并发连接数。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
9.0pt;margin-left:21.25pt;text-indent:-21.25pt;mso-char-indent-count:0;
line-height:21.0pt;mso-list:l16 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:宋体;mso-bidi-theme-font:
minor-fareast;color:#333333'><span style='mso-list:Ignore'>2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;color:#333333'>内存消耗少：同等硬件环境下，<span lang=EN-US>Nginx</span>的处理能力相当于<span
lang=EN-US>Apache</span>的<span lang=EN-US>5</span>～<span lang=EN-US>10</span>倍。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
9.0pt;margin-left:21.25pt;text-indent:-21.25pt;mso-char-indent-count:0;
line-height:21.0pt;mso-list:l16 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:宋体;mso-bidi-theme-font:
minor-fareast;color:#333333'><span style='mso-list:Ignore'>3<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;color:#333333'>Nginx</span><span
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;color:#333333'>作为<span lang=EN-US>WEB</span>服务器，<span lang=EN-US>Nginx</span>处理静态文件、索引文件、自动索引的效率非常高。
<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
9.0pt;margin-left:21.25pt;text-indent:-21.25pt;mso-char-indent-count:0;
line-height:21.0pt;mso-list:l16 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:宋体;mso-bidi-theme-font:
minor-fareast;color:#333333'><span style='mso-list:Ignore'>4<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;color:#333333'>Nginx</span><span
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;color:#333333'>作为代理服务器，<span lang=EN-US>Nginx</span>可以实现无缓存的反向代理，提高网站的性能
<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
9.0pt;margin-left:21.25pt;text-indent:-21.25pt;mso-char-indent-count:0;
line-height:21.0pt;mso-list:l16 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='font-family:"Helvetica","sans-serif";mso-fareast-font-family:
Helvetica;color:#333333'><span style='mso-list:Ignore'>5<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US style='mso-ascii-font-family:
宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
color:#333333'>Nginx</span><span style='mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;color:#333333'>作为负载均衡服务器，内部可以支持<span
lang=EN-US>PHP</span>、也可以支持<span lang=EN-US>HTTP</span>代理服务器对外进行服务，同时还支持简单的容错和利用算法进行负载</span><span
lang=EN-US style='font-family:"Helvetica","sans-serif";mso-bidi-font-family:
宋体;color:#333333'><o:p></o:p></span></p>

<p class=MsoListParagraph style='margin-top:0cm;margin-right:0cm;margin-bottom:
9.0pt;margin-left:21.25pt;text-indent:-21.25pt;mso-char-indent-count:0;
line-height:21.0pt;mso-list:l16 level1 lfo4'><![if !supportLists]><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:宋体;mso-bidi-theme-font:
minor-fareast;color:#333333'><span style='mso-list:Ignore'>6<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;color:#333333'>成本低廉：<span lang=EN-US>Nginx</span>为开源软件，采用的是<span
lang=EN-US>2-clause BSD-like</span>协议，可以免费使用，并可用于商业用途。该协议衍生自<span lang=EN-US>BSD</span>协议，但删掉了其中的<span
lang=EN-US>“</span>不可以用开源代码的作者<span lang=EN-US>/</span>机构名字和原来产品的名字做市场推广<span
lang=EN-US>”</span>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-left:21.25pt;text-indent:-21.25pt;
mso-char-indent-count:0;mso-list:l16 level1 lfo4'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>7<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='mso-ascii-font-family:宋体;
mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
color:#333333'>其他：配置文件简单，支持<span lang=EN-US>Rewrite</span>重写规则，内置的健康检查功能，节省带宽，</span>稳定性高，支持热部署。
</p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>1.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>缺点</span></h2>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>功能没有<span
lang=EN-US>apache</span>支持的多，没有很多额外的功能。</p>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>不支持<span
lang=EN-US>cgi,</span>仅支持<span lang=EN-US>fastcgi</span>方式（<span lang=EN-US>fastcgi</span>通过监听<span
lang=EN-US>tcp</span>接受远程请求）。</p>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>代理方面，不支持<span
lang=EN-US>Https</span>代理</p>

<h1><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]>成功案例</h1>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>2.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>nginx</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>客户</span></h2>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>它已经在众多流量很大的俄罗斯网站上使用了很长时间，这些网站包括<span
lang=EN-US><a href="http://www.yandex.ru">Yandex</a></span>、<span lang=EN-US><a
href="http://www.mail.ru">Mail.Ru</a></span>、<span lang=EN-US><a
href="http://www.vkontakte.ru">VKontakte</a></span>，以及<span lang=EN-US><a
href="http://www.rambler.ru">Rambler</a></span>。据<span lang=EN-US>Netcraft</span>统计，在<span
lang=EN-US>2012</span>年<span lang=EN-US>8</span>月份，<span lang=EN-US><a
href="http://news.netcraft.com/archives/2012/08/02/august-2012-web-server-survey.html"><span
lang=EN-US><span lang=EN-US>世界上最繁忙的网站中有11.48%</span></span></a></span>使用<span
lang=EN-US>Nginx</span>作为其服务器或者代理服务器。部分成功案例请见： <span lang=EN-US><a
href="https://signup.netflix.com/openconnect/software">Netflix</a></span>， <span
lang=EN-US><a href="http://barry.wordpress.com/2008/04/28/load-balancer-update/">Wordpress.com</a></span>，
<span lang=EN-US><a
href="http://blog.fastmail.fm/2007/01/04/webimappop-frontend-proxies-changed-to-nginx/">FastMail.FM</a></span>。</p>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>国内客户：金山、新浪、迅雷</p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>2.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>nginx</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>的修改版</span><span lang=EN-US>tengine</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>的客户</span></h2>

<p class=MsoNormal>天猫、淘宝、支付宝、</p>

<p class=MsoNormal><span lang=EN-US>51cto</span>、腾讯、土豆、京东、酷六、<span lang=EN-US>PPLIVE</span>、开源中国、凤凰网、<span
lang=EN-US>Internet Archive</span>等 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>数据来源： <span lang=EN-US><a
href="http://tengine.taobao.org/download/tengine@alibaba.pdf">http://tengine.taobao.org/download/tengine@alibaba.pdf</a>
</span><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><o:p></o:p></span></b></p>

<h1><![if !supportLists]><span class=1Char><span lang=EN-US style='font-weight:
normal'><span style='mso-list:Ignore'>3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span></span><![endif]><span class=1Char><span style='font-weight:
normal'>入门篇<span lang=EN-US><o:p></o:p></span></span></span></h1>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>3.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span class=1Char><span lang=EN-US
style='font-size:22.0pt;line-height:173%;font-weight:normal'>windows</span></span><span
class=1Char><span style='font-size:22.0pt;line-height:173%;font-weight:normal'>下安装启动</span></span></h2>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>本文使用<span
lang=EN-US>windows</span>版本，总共三个步骤，下载，解压、启动。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>下载<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.nginx.org/download/nginx-1.1.2.zip"><span style='font-size:
10.5pt;mso-bidi-font-size:12.0pt'>http://www.nginx.org/download/nginx-1.1.2.zip</span></a></span><u><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt;color:blue'><o:p></o:p></span></u></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>解压<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>解压到目录<span
lang=EN-US>D:\nginx-1.1.2<o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>启动<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>双击<span
lang=EN-US>nginx.exe</span>就可以了，也可以通过命令行执行<span lang=EN-US>start nginx.exe</span>。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt;mso-no-proof:yes'><v:shapetype id="_x0000_t75" coordsize="21600,21600"
 o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe" filled="f"
 stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="_x0000_i1091" type="#_x0000_t75" style='width:414.75pt;
 height:56.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image001.png" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>如果在命令行中，执行<span
lang=EN-US>nginx.exe</span>，就会进入监听状态。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>访问</span><span lang=EN-US><a
href="http://127.0.0.1/"><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://127.0.0.1/</span></a></span><u><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt;color:blue'> </span></u><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>就可以看到了。 <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l7 level1 lfo6'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>其他命令：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>停止命令<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>nginx -s stop</span><span style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>如果执行了多次<span
lang=EN-US>ngin.exe</span>，只能关闭其中的一个。<span lang=EN-US>D:\nginx-1.1.2\logs\nginx.pid<span
style='mso-spacerun:yes'>&nbsp; </span></span>这个文件记录可以最后一个打开的进程编号。 <span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>更多可以参考<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://tengine.taobao.org/book/appendix_c.html#nginxwindows"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://tengine.taobao.org/book/appendix_c.html#nginxwindows</span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'> <o:p></o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>3.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>linux</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>下安装启动</span></h2>

<p class=MsoNormal>在<span lang=EN-US>centos</span>环境下</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l8 level1 lfo5'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>yum install nginx<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span>安装</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l8 level1 lfo5'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>service nginx<span
style='mso-spacerun:yes'>&nbsp; </span>start<span
style='mso-spacerun:yes'>&nbsp; </span>#</span>启动</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l8 level1 lfo5'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>然后客户端通过浏览器访问 <span lang=EN-US><a
href="http://127.0.0.1/">http://127.0.0.1/</a> </span>就可以了</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>查看安装文件</p>

<p class=MsoNormal><span lang=EN-US>[root@ippdev5 ~]# find / -name nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/usr/share/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/usr/sbin/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/var/log/nginx<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>#</span>日志位置</p>

<p class=MsoNormal><span lang=EN-US>/var/lib/yum/repos/x86_64/6/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/var/cache/yum/x86_64/6/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/var/cache/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/etc/logrotate.d/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/etc/rc.d/init.d/nginx<span
style='mso-spacerun:yes'>&nbsp; </span>#</span>启动文件</p>

<p class=MsoNormal><span lang=EN-US>/etc/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>/etc/sysconfig/nginx</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://tengine.taobao.org/book/appendix_c.html#nginxlinux"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://tengine.taobao.org/book/appendix_c.html#nginxlinux</span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><o:p></o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>3.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>nginx</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>工作模型</span></h2>

<p class=MsoNormal><span lang=EN-US>nginx</span>启动时会启动一个<span lang=EN-US>master</span>的主进程，然后是从进程。从进程的数目和配置相关，默认是一个。<span
lang=EN-US>master</span>进程接受用户的操作，然后把相关信号在传递给个个<span lang=EN-US>worker</span>进程。
连接请求由<span lang=EN-US>work</span>进程负责处理。</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_63"
 o:spid="_x0000_i1090" type="#_x0000_t75" style='width:415.5pt;height:255pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image002.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal>参考资料 <span lang=EN-US><a
href="http://tengine.taobao.org/book/chapter_02.html#id1">http://tengine.taobao.org/book/chapter_02.html#id1</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>3.4<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>配置</span></h2>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>配置是个技术活，首先要知道配置文件的路径和配置文件的规则。<span
lang=EN-US><o:p></o:p></span></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>3.4.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>配置文件路径</h3>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l3 level1 lfo7'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>windwos</span>配置文件：<span
lang=EN-US>nginx-1.1.2\conf\nginx.conf</span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l3 level1 lfo7'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>linux</span>环境，配置文件路径</p>

<p class=MsoNormal>配置一般的路径：<span lang=EN-US> /etc/nginx/nginx.conf </span></p>

<p class=MsoNormal><span lang=EN-US>yum install</span>安装后，配置文件在<span
lang=EN-US>/etc/nginx/nginx.conf </span>和<span lang=EN-US> conf.d</span>下面。</p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>3.4.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>配置文件格式</h3>

<p class=MsoNormal>配置文件分为单项配置和组合配置</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l1 level1 lfo9'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>单项配置格式： </p>

<p class=MsoNormal style='margin-left:21.0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>指令 <span lang=EN-US>[</span>指令选项<span
lang=EN-US>] </span>值<span lang=EN-US>;(</span>包括分号<span lang=EN-US>)</span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l1 level1 lfo9'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>组合配置格式： </p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>指令<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span>[</span>值<span lang=EN-US>]<span
style='mso-spacerun:yes'>&nbsp; </span>{</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>（单项配置或者多项配置）<span
lang=EN-US>*</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span>}</span></p>

<p class=MsoNormal>注意：官方没有这么描述，绝大部分的规则是这两种。</p>

<p class=MsoNormal><span lang=EN-US>nginx</span>常用的三个组合配置<span lang=EN-US> http</span>、<span
lang=EN-US>server</span>、<span lang=EN-US>location,</span>注意它们是嵌套关系。</p>

<p class=MsoNormal><span lang=EN-US>http<span style='mso-spacerun:yes'>&nbsp;
</span>{<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span>server {</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>location {</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>}</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal><span lang=EN-US>}</span></p>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>在配置的时候一定分清楚配置项是在哪个组合配置中配置的，一般指令参考中会指明是哪个指令（正式的说法叫指令上下文），<span
style='color:red'>这三个层次关系一定要记住</span>。 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>3.4.3<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>默认配置详解</h3>

<p class=MsoNormal>通过下面这个命令可以，查看<span lang=EN-US>nginx</span>的有效配置（过滤了注释和空行）</p>

<p class=MsoNormal><span lang=EN-US>grep -v '^\s*#'<span
style='mso-spacerun:yes'>&nbsp; </span>/etc/nginx/nginx.conf | grep -v
&quot;^$&quot; </span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>精简配置如下</p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>worker_processes<span
style='mso-spacerun:yes'>&nbsp; </span>1;<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>#</span><span style='font-size:
9.0pt;font-family:"微软雅黑","sans-serif"'>使用一个进程处理<span lang=EN-US>http</span>请求<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>events
{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>worker_connections<span
style='mso-spacerun:yes'>&nbsp; </span>1024;<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>#</span><span style='font-size:
9.0pt;font-family:"微软雅黑","sans-serif"'>每个进程处理<span lang=EN-US>1024</span>个连接<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>http
{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>include<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>mime.types;<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>#
mime</span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>文件类型的定义<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>default_type<span
style='mso-spacerun:yes'>&nbsp; </span>application/octet-stream;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:9.0pt;
font-family:"微软雅黑","sans-serif"'>默认的文件类型 <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>sendfile<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>on;<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span># </span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>支持文件发送<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>keepalive_timeout<span
style='mso-spacerun:yes'>&nbsp; </span>65;<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span># </span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>连接保持时间<span
lang=EN-US>65</span>秒<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server {<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>#</span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>定义一个服务器<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>listen<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>80;<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>#<span style='mso-spacerun:yes'>&nbsp; </span></span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>监听<span lang=EN-US>80</span>端口<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>server_name<span style='mso-spacerun:yes'>&nbsp; </span>localhost;<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span># </span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>服务器的名称<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>location / {<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span># url </span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>匹配<span
lang=EN-US> / </span>执行下面的规则<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>root<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>html;<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span># web</span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>的根目录，相对目录是在<span
lang=EN-US>nginx</span>下面<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>index<span style='mso-spacerun:yes'>&nbsp; </span>index.html index.htm;
# index</span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>首页查找顺序，先找<span
lang=EN-US>index.html,</span>找不到找<span lang=EN-US>index.htm<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>error_page<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>500 502 503
504<span style='mso-spacerun:yes'>&nbsp; </span>/50x.html; # </span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>错误码是<span lang=EN-US>
500</span>等的时候，匹配<span lang=EN-US>50x.html</span>页面<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>location = /50x.html {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>root<span style='mso-spacerun:yes'>&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span>html;<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span># 50x.html</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>所在的根目录<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif"'>}<o:p></o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>3.5<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>小实验</span></h2>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>nginx</span>命令</h3>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l5 level1 lfo18'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>帮助命令</p>

<p class=MsoNormal><span lang=EN-US>nginx –h<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l5 level1 lfo18'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>查看版本和支持的模块</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>nginx –V</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_68" o:spid="_x0000_i1089"
 type="#_x0000_t75" style='width:415.5pt;height:34.5pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image003.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l5 level1 lfo18;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>优雅重启命令，等待<span lang=EN-US>work</span>进程处理完请求</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>nginx –s reload</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l5 level1 lfo18;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>测试配置，每次修改配置后测试一下</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>nginx –t </span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>其他命令可以通过帮助查看</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>查看日志</h3>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>server {</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>root<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/spool/vhost/data/$host;</span></p>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>access_log<span
style='mso-spacerun:yes'>&nbsp; </span>/var/log/nginx/log/host.access.log ;</span><span
lang=EN-US> </span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>access_log</span><span style='background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>指令说明</span>在<span lang=EN-US>/varlog/nginx/log/
host.access.log </span>有访问日志</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>查看<span lang=EN-US>nginx</span>状态</h3>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>location /status {<span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span>#</span>定义路径</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span>stub_status on;<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>#</span>开启监控</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>}</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'>配置完后重新启动<span
lang=EN-US>Nginx</span>后我们可以通过浏览器访问<span lang=EN-US>http://localhost/status </span>查看
</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_69" o:spid="_x0000_i1088"
 type="#_x0000_t75" style='width:296.25pt;height:141pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image004.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US>Active connections<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>//</span>当前<span lang=EN-US>
Nginx </span>正处理的活动连接数。</p>

<p class=MsoNormal><span lang=EN-US>server accepts handled requests //</span>总共处理了<span
lang=EN-US>8 </span>个连接<span lang=EN-US> , </span>成功创建<span lang=EN-US> 8 </span>次握手<span
lang=EN-US>,</span>总共处理了<span lang=EN-US>500</span>个请求。</p>

<p class=MsoNormal><span lang=EN-US>Reading //nginx </span>读取到客户端的<span
lang=EN-US> Header </span>信息数。</p>

<p class=MsoNormal><span lang=EN-US>Writing //nginx </span>返回给客户端的<span
lang=EN-US> Header </span>信息数。</p>

<p class=MsoNormal><span lang=EN-US>Waiting //</span>开启<span lang=EN-US>
keep-alive </span>的情况下，这个值等于<span lang=EN-US> active - (reading + writing)</span>，意思就是<span
lang=EN-US> Nginx </span>已经处理完正在等候下一次请求指令的驻留连接</p>

<p class=MsoNormal>通过命令查看 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.4<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>定制目录 </h3>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>location / {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>#root<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>html;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>root<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>d:\myweb;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:10.5pt;
mso-bidi-font-size:12.0pt'>修改<span lang=EN-US>root</span>的根目录<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>index<span style='mso-spacerun:yes'>&nbsp; </span>index.html index.htm; <span
style='mso-spacerun:yes'>&nbsp;&nbsp;</span>#</span><span style='font-size:
10.5pt;mso-bidi-font-size:12.0pt'>修改首页查找的顺序</span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>修了：<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l6 level1 lfo8'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>根目录为<span lang=EN-US>
d:\myweb</span>。 尽量使用这种路径风格<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span>d:/myweb, </span>要不然会在转移字符下出问题，<span
lang=EN-US>nginx</span>没有检测。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l6 level1 lfo8'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>修改主页查找顺序先找<span lang=EN-US>index.html</span>，找不到查找<span
lang=EN-US>index.htm<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>重新加载配置<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:5.25pt;mso-char-indent-count:.5'><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>nginx -s reload </span><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>记得每次修改后都要执行！ <span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.5<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>监听多个端口 </h3>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>server {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>listen 80;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>listen 81;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>同时监听<span
lang=EN-US>80,81</span>端口，访问</span><span lang=EN-US><a href="http://127.0.0.1"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://127.0.0.1</span></a></span><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>和访问</span><span lang=EN-US><a
href="http://127.0.0.1:81/"><span style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>http://127.0.0.1:81/</span></a></span><span style='font-size:10.5pt;
mso-bidi-font-size:12.0pt'>一样的效果。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.6<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>配置多个端口</h3>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>独立的监听端口配置
<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>server <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>listen 82;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>location / {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>root<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>html;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>index<span
style='mso-spacerun:yes'>&nbsp; </span>index.html index.htm;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.7<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>配置虚拟主机</h3>

<p class=MsoNormal>通过不同的域名，实现加载不同的内容。</p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>server <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>listen 80;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>server_name<span style='mso-spacerun:yes'>&nbsp; </span>allinpay.com;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>location / {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp; </span>root<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>html1;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>index<span style='mso-spacerun:yes'>&nbsp; </span>index.html index.htm;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>server <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>listen 80;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>server_name<span style='mso-spacerun:yes'>&nbsp; </span>allinpay.net;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>location / {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp; </span>root<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>html2;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>index<span style='mso-spacerun:yes'>&nbsp; </span>index.html index.htm;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>都是监听<span
lang=EN-US>80</span>端口，通过则访问不同的域名访问不同的路径<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.8<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>配置虚拟目录</h3>

<p class=MsoNormal>在<span lang=EN-US>server</span>上下文中，定义<span lang=EN-US>wiki</span>的虚拟目录</p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>location /wiki {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>#</span><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>加不加<span
lang=EN-US>/</span>都可以<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>#alias d:/myweb/mywiki/;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>alias d:/myweb/mywiki;<span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span>#<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>index <span
style='mso-spacerun:yes'>&nbsp;</span><span
style='mso-spacerun:yes'>&nbsp;</span>index.html index.htm ;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a href="http://ip/wiki">http://ip/wiki</a><span
style='mso-spacerun:yes'>&nbsp; </span></span>则访问<span lang=EN-US>
d:/myweb/mywiki</span>下面的目录</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>定义虚拟目录的时候，注意目录匹配的优先级。配置文件的先后顺序匹配。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>注意<span lang=EN-US>alias</span>和<span lang=EN-US>root</span>的区别</p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>location /wiki { <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>root d:/myweb/mywiki; <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>index <span style='mso-spacerun:yes'>&nbsp;</span><span
style='mso-spacerun:yes'>&nbsp;</span>index.html index.htm ;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal>实际访问的目录是<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span>d:/mweb/mywiki/wiki</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.9<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>文件服务器</h3>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'>location /download
{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>alias<span
style='mso-spacerun:yes'>&nbsp; </span>/root/download;<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span># </span><span style='font-size:
10.5pt'>本机目录<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>autoindex on;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:10.5pt'>自动产生
索引<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp; </span><span style='mso-tab-count:1'>&nbsp; </span>limit_rate
512k;<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>#</span><span
style='font-size:10.5pt'>下载速度不超过<span lang=EN-US>512K<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span style='mso-tab-count:1'> </span>charset
utf-8;<span style='mso-spacerun:yes'>&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>#
html</span><span style='font-size:10.5pt'>网站编码格式<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span>autoindex_exact_size off; #</span><span
style='font-size:10.5pt'>友好显示文件大小<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>autoindex_localtime on;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:10.5pt'>使用本地时间<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span>index index.html;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:10.5pt'>默认主页<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://wiki.nginx.org/HttpAccessModule#allow">http://wiki.nginx.org/HttpAccessModule#allow</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.5.10<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>访问限制</h3>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>location / {</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US
style='font-size:10.5pt'>allow 127.0.0.1</span><span style='font-size:10.5pt'>；
<span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span>#</span>本机访问<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US
style='font-size:10.5pt'>allow 192.168.1.0/24; #192.168.1.0</span><span
style='font-size:10.5pt'>网段可以访问<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>deny all;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:10.5pt'>其他禁止访问
</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span>}</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://nginx.org/en/docs/http/ngx_http_access_module.html">http://nginx.org/en/docs/http/ngx_http_access_module.html</a></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h1><![if !supportLists]><span class=1Char><span lang=EN-US><span
style='mso-list:Ignore'>4<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span></span></span></span><![endif]><span class=1Char><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>提高篇<span lang=EN-US><o:p></o:p></span></span></h1>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>Location</span><span style='font-family:
宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:Cambria;
mso-hansi-theme-font:major-latin'>详解</span></h2>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='mso-cellspacing:0cm;mso-yfti-tbllook:1184'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>语法<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><b><span lang=EN-US>location</span></b><span lang=EN-US> [
  = | ~ | ~* | ^~ ] <i>uri</i> { ... }<br>
  <b>location</b> @<i>name</i> { ... }</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>默认值<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>— </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>上下文<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>server, location</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span lang=EN-US>url</span>匹配规则：</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l20 level1 lfo13'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>有两种匹配规则，第一种是前缀字符串<span lang=EN-US>(=,/)</span>，第二种是正则表达式。使用正则表达式的时候需要在路径开始添加<span
lang=EN-US>“<code>~*</code>”</span>前缀<span lang=EN-US> (</span>不区分大小写<span
lang=EN-US>)</span>，或者<span lang=EN-US>“<code>~</code>”</span>前缀<span
lang=EN-US>(</span>区分大小写<span lang=EN-US>)</span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l13 level1 lfo12'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1．</span></span><![endif]>使用<span
lang=EN-US>“<code>=</code>”</span>前缀可以定义<span lang=EN-US>URI</span>和路径的精确匹配，如果发现匹配，则终止路径查找。</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l13 level1 lfo12'><![if !supportLists]><b
style='mso-bidi-font-weight:normal'><span lang=EN-US><span style='mso-list:
Ignore'>2．<span style='font:7.0pt "Times New Roman"'> </span></span></span></b><![endif]><b
style='mso-bidi-font-weight:normal'>匹配过程<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l12 level1 lfo14'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>先查找前缀字符串最长匹配</p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l12 level1 lfo14'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>如果是精确匹配这选中<span lang=EN-US>,</span>结束</p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l12 level1 lfo14'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>如果不是精确匹配则备选</p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l12 level1 lfo14'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>d.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>则按照配置文件的顺序查找正则，</p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l12 level1 lfo14'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>e.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>如果匹配正则则使用<span lang=EN-US>,</span>结束</p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l12 level1 lfo14'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>f.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>如果还找不到，则重新备选的匹配， 结束</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>让我们用一个例子解释上面的说法：
</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
= / {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>[ configuration A ]<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
/ {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>[ configuration B ]<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
/documents/ {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>[ configuration C ]<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
^~ /images/ {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>[ configuration D ]<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
~* \.(gif|jpg|jpeg)$ { <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>[ configuration E ] <o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}
<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>请求<span
lang=EN-US>“/”</span>匹配配置<span lang=EN-US>A</span>， 请求<span lang=EN-US>“/index.html”</span>匹配配置<span
lang=EN-US>B</span>， 请求<span lang=EN-US>“/documents/document.html”</span>匹配配置<span
lang=EN-US>C</span>， 请求<span lang=EN-US>“/images/1.gif”</span>匹配配置<span
lang=EN-US>D</span>， 请求<span lang=EN-US>“/documents/1.jpg”</span>匹配配置<span
lang=EN-US>E</span>。 <span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>前缀<span
lang=EN-US>“@”</span>定义了命名路径。这种路径不在一般的请求处理中使用， 而是用在请求重定向中。这些路径不能嵌套，也不能包含嵌套路径。 </p>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>常用的表达式<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span lang=EN-US>^/image/<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>以<span
lang=EN-US>/image/</span>开头的<span lang=EN-US>uri</span></p>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span lang=EN-US>.(gif|jpg|jpeg|png|bmp|ico)$<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span>以图片结尾的文件</p>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'>参考资料<span lang=EN-US><a
href="http://nginx.org/cn/docs/http/ngx_http_core_module.html#location">http://nginx.org/cn/docs/http/ngx_http_core_module.html#location</a></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>Nginx</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>全局变量</span></h2>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>下面是可以用作判断的全局变量<span lang=EN-US><br>
</span>例：<span lang=EN-US><a href="http://localhost:88/test1/test2/test.php">http://localhost:88/test1/test2/test.php</a><br>
$host</span>：<span lang=EN-US>localhost<br>
$server_port</span>：<span lang=EN-US>88<br>
$request_uri</span>：<span lang=EN-US><a
href="http://localhost:88/test1/test2/test.php">http://localhost:88/test1/test2/test.php</a><br>
$document_uri</span>：<span lang=EN-US>/test1/test2/test.php<br>
$document_root</span>：<span lang=EN-US>D:\nginx/html<br>
$request_filename</span>：<span lang=EN-US>D:\nginx/html/test1/test2/test.php</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>Nginx</span>支持的<span lang=EN-US>http</span>变量实现在<span
lang=EN-US>&nbsp;ngx_http_variables.c </span>的 <b style='mso-bidi-font-weight:
normal'><span lang=EN-US>ngx_http_core_variables<span style='mso-no-proof:yes'>
</span></span></b><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_66"
 o:spid="_x0000_i1087" type="#_x0000_t75" alt="http://pic002.cnblogs.com/images/2011/2188/2011121019182787.jpg"
 style='width:415.5pt;height:219pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image005.jpg" o:title="2011121019182787"/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_67"
 o:spid="_x0000_i1086" type="#_x0000_t75" alt="http://pic002.cnblogs.com/images/2011/2188/2011121019185923.jpg"
 style='width:415.5pt;height:218.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image006.jpg" o:title="2011121019185923"/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考资料<span lang=EN-US>:</span></p>

<p class=MsoNormal><span lang=EN-US>http://www.cnblogs.com/AloneSword/archive/2011/12/10/2283483.html</span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>URL</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>重写</span></h2>

<p class=MsoNormal>通常将用户请求的<span lang=EN-US>url</span>转换成实际的<span lang=EN-US>url,</span>已达到用户友好、安全或者部署的要求。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考：<span lang=EN-US><a
href="http://wiki.nginx.org/HttpRewriteModule">http://wiki.nginx.org/HttpRewriteModule</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.3.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>基础
</h3>

<p class=MsoNormal><span lang=EN-US>rewrite </span>的语法格式</p>

<table class=MsoTableGrid border=1 cellspacing=0 cellpadding=0
 style='border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;
 mso-yfti-tbllook:1184;mso-padding-alt:0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td valign=top style='border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='background:#D9D9D9;mso-shading:
  white;mso-pattern:gray-15 auto'>Syntax:</span></b><span lang=EN-US
  style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p></o:p></span></p>
  </td>
  <td valign=top style='border:solid windowtext 1.0pt;border-left:none;
  mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='background:#D9D9D9;mso-shading:
  white;mso-pattern:gray-15 auto'>rewrite</span></b><span lang=EN-US
  style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'> <i>regex</i>
  <i>replacement</i> [ <i>flag</i> ]<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='background:#D9D9D9;mso-shading:
  white;mso-pattern:gray-15 auto'>Default:</span></b><span lang=EN-US
  style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p></o:p></span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
  mso-pattern:gray-15 auto'>无<span lang=EN-US><o:p></o:p></span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td valign=top style='border:solid windowtext 1.0pt;border-top:none;
  mso-border-top-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><b><span lang=EN-US style='background:#D9D9D9;mso-shading:
  white;mso-pattern:gray-15 auto'>Context:</span></b><span lang=EN-US
  style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p></o:p></span></p>
  </td>
  <td valign=top style='border-top:none;border-left:none;border-bottom:solid windowtext 1.0pt;
  border-right:solid windowtext 1.0pt;mso-border-top-alt:solid windowtext .5pt;
  mso-border-left-alt:solid windowtext .5pt;mso-border-alt:solid windowtext .5pt;
  padding:0cm 5.4pt 0cm 5.4pt'>
  <p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:
  white;mso-pattern:gray-15 auto'>server<br>
  location<br>
  if<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>rewrite</span>工作机制是通过正则表达式的<b
style='mso-bidi-font-weight:normal'>组匹配</b>模式匹配请求的<span lang=EN-US>URL</span>，然后根据后面的规则定义新的<span
lang=EN-US>URL</span>。</p>

<p class=MsoNormal>举个例子：</p>

<p class=MsoNormal>一个<span lang=EN-US>restful</span>风格转换</p>

<p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>用户请求 <span lang=EN-US>/user/1<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>web</span><span style='background:#D9D9D9;mso-shading:
white;mso-pattern:gray-15 auto'>服务器实际上是<span lang=EN-US> /user.jsp?id=1<o:p></o:p></span></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>rewrite</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>的规则<span
lang=EN-US>: rewrite<span style='mso-spacerun:yes'>&nbsp; </span>/user/(\d+) /user.jsp?id=$1<o:p></o:p></span></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>$1</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>就代表<span
lang=EN-US>(\d+)</span>匹配到的字符串<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>flag</span>标记有： </p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>last </span>相当于<span lang=EN-US>Apache</span>里的<span
lang=EN-US>[L]</span>标记，表示完成<span lang=EN-US>rewrite </span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>break </span>终止匹配<span lang=EN-US>, </span>不再匹配后面的规则
</p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>redirect </span>返回<span lang=EN-US>302</span>临时重定向
地址栏会显示跳转后的地址 </p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>permanent </span>返回<span lang=EN-US>301</span>永久重定向
地址栏会显示跳转后的地址 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>正则表达式匹配，其中： </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>~ </span>为区分大小写匹配 </p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>~* </span>为不区分大小写匹配 </p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>!~</span>和<span lang=EN-US>!~*</span>分别为区分大小写不匹配及不区分大小写不匹配
</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>文件及目录匹配，其中： </p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>-f</span>和<span lang=EN-US>!-f</span>用来判断是否存在文件
</p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>-d</span>和<span lang=EN-US>!-d</span>用来判断是否存在目录
</p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>-e</span>和<span lang=EN-US>!-e</span>用来判断是否存在文件或目录
</p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>-x</span>和<span lang=EN-US>!-x</span>用来判断文件是否可执行
</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.3.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>配置实例</h3>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>在<span lang=EN-US>Location</span>上下文中 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>跳转到特定目录 <span
lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal>例如下面设定<span lang=EN-US>nginx</span>在用户使用<span lang=EN-US>ie</span>的使用重定向到<span
lang=EN-US>/nginx-ie</span>目录下： </p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>if ($http_user_agent ~ MSIE) {<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>rewrite ^(.*)$ /nginx-ie/$1 break;<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>}<span style='mso-spacerun:yes'>&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>上下：<span lang=EN-US>Location<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>域名跳转<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal>访问<span lang=EN-US>qq.com</span>直接跳转到<span lang=EN-US>news.qq.com</span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>if ($host ~ ^qq\.com&quot;) {<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>rewrite ^(.*) http://news.qq.com$1/ permanent;<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>}<span style='mso-spacerun:yes'>&nbsp; </span><o:p></o:p></span></p>

<p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>上下：<span lang=EN-US>Location<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>防盗链<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>location ~* \.(gif|jpg|swf)$ {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>#</span><span style='background:#D9D9D9;mso-shading:
white;mso-pattern:gray-15 auto'>如果上一个连接不是从<span lang=EN-US>jd.com</span>下面访问静态资源的<span
lang=EN-US>,</span>说明是个无效的连接<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>invalid_referers none blocked jd.com; <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>if ($invalid_referer) {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>rewrite ^/ </span><span lang=EN-US><a
href="http://$host/err.html"><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>http://$host/err.html</span></a><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span></span><span style='background:
#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>定向到<span lang=EN-US>error</span>界面<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>上下：<span lang=EN-US>Location<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;</span></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.4<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>正向代理</span>
</h2>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>正向代理就是做代理服务器的功能。<span
lang=EN-US>nginx</span>做中间人，转发客户端请求到目标主机上。</p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>server {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>listen<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>8000;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>server_name<span style='mso-spacerun:yes'>&nbsp; </span>localhost;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>client_header_buffer_size 32k;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>large_client_header_buffers 4 128k;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>location / {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>proxy_buffering on;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>proxy_buffer_size 32k;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>proxy_buffers 8 64k;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>proxy_busy_buffers_size 128k;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;&nbsp;</span>#<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;</span>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>Host $host;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;</span>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>X-Real-IP $host;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>proxy_set_header<span style='mso-spacerun:yes'>&nbsp;
</span>X-Forwarded-For $host;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span># </span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>转发到对应的目标主机上 <span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>proxy_pass </span><span lang=EN-US><a
href="http://$http_host$request_uri"><span style='font-size:9.0pt;font-family:
"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>http://$http_host$request_uri</span></a></span><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:
#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:42.0pt;mso-para-margin-left:3.5gd;
text-indent:18.0pt;mso-char-indent-count:2.0'><span lang=EN-US
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>resolver 114.114.114</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>；<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:42.0pt;mso-para-margin-left:3.5gd;
text-indent:18.0pt;mso-char-indent-count:2.0'><span lang=EN-US
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";mso-bidi-font-family:
"Courier New";background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>resolver_timeout
5s;</span><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:60.0pt;mso-para-margin-left:5.0gd'><code><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";color:black;
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_send_timeout&nbsp;&nbsp;&nbsp;300;</span></code><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";color:black;
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'> <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:60.0pt;mso-para-margin-left:5.0gd'><code><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";color:black;
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_read_timeout&nbsp;&nbsp;&nbsp;300;<o:p></o:p></span></code></p>

<p class=MsoNormal style='margin-left:60.0pt;mso-para-margin-left:5.0gd'><code><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";color:black;
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_connect_timeout&nbsp;30s;<o:p></o:p></span></code></p>

<p class=MsoNormal style='margin-left:42.0pt;mso-para-margin-left:3.5gd;
text-indent:18.0pt;mso-char-indent-count:2.0'><span lang=EN-US
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>#</span><span style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>关闭访问日志，如果需要，默认是开启的。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>access_log off;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>浏览器设置<span
lang=EN-US>127.0.0.1 8000</span>，注意选中本地也使用代理服务器。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>常见错误<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>错误：<span
lang=EN-US>bad gateway 502<o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>查看错误日志<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>2011/09/18 17:53:53 [error] 7504#7580: *1 no resolver defined to
resolve www.baidu.com, client: 127.0.0.1, server: localhost, request: &quot;GET
</span><span lang=EN-US><a href="http://www.baidu.com/"><span style='font-size:
10.5pt;mso-bidi-font-size:12.0pt'>http://www.baidu.com/</span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'> HTTP/1.1&quot;,
host: &quot;www.baidu.com&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>不能解析
</span><span lang=EN-US><a href="http://www.baidu.com，也就是说域名解析错误"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>www.baidu.com</span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span lang=EN-US>，也就是说域名解析错误</span></span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>在<span
lang=EN-US>http</span>中配置<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp; </span>#dns</span><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>服务器或者网关地址<span lang=EN-US>, <o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp; </span><span
style='mso-spacerun:yes'>&nbsp;</span>resolver 114.114.114<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>注意：<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US>1. </span>不能有<span lang=EN-US>hostname</span></p>

<p class=MsoNormal><span lang=EN-US>2. </span>必须有<span lang=EN-US>resolver, </span>即<span
lang=EN-US>dns</span>，即上面的<span lang=EN-US>x.x.x.x</span>，换成你们的<span
lang=EN-US>DNS</span>服务器<span lang=EN-US>ip</span>即可</p>

<p class=MsoNormal><span lang=EN-US>3 . $http_host</span>和<span lang=EN-US>$request_uri</span>是<span
lang=EN-US>nginx</span>系统变量，不要想着替换他们，保持原样就<span lang=EN-US>OK</span>。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>查看<span lang=EN-US>dns</span>方法</p>

<p class=MsoNormal><span lang=EN-US>cat /etc/resolv.conf</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_33"
 o:spid="_x0000_i1085" type="#_x0000_t75" style='width:315.75pt;height:117.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image007.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_30"
 o:spid="_x0000_i1084" type="#_x0000_t75" style='width:282.75pt;height:172.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image008.png" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_32"
 o:spid="_x0000_i1083" type="#_x0000_t75" style='width:396.75pt;height:120.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image009.png" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_34"
 o:spid="_x0000_i1082" type="#_x0000_t75" style='width:366.75pt;height:72.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image010.png" o:title=""/>
</v:shape></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考资料</p>

<p class=MsoNormal><span lang=EN-US><a
href="http://wiki.nginx.org/HttpProxyModule">http://wiki.nginx.org/HttpProxyModule</a><span
style='mso-spacerun:yes'>&nbsp; </span></span>参考大全</p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.5<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>反向代理</span></h2>

<p class=MsoNormal>反向代理就是把客户端的请求，转发到后台服务器中。</p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.5.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>单个</h3>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>location / {</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>proxy_pass<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>http://localhost:8080;</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>proxy_set_header<span style='mso-spacerun:yes'>&nbsp; </span>X-Real-IP <span
style='mso-spacerun:yes'>&nbsp;</span>$remote_addr;</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>}</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>将<span
lang=EN-US>jenkins</span>上的请求，转发到<span lang=EN-US>8080</span>的服务上<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>location /jenkins {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>proxy_pass<span style='mso-spacerun:yes'>&nbsp; </span></span><span
lang=EN-US><a href="http://127.0.0.1:8080"><span style='font-size:10.5pt;
mso-bidi-font-size:12.0pt'>http://127.0.0.1:8080</span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>会自动访问
</span><span lang=EN-US><a href="http://127.0.0.1:8080/jenkins?"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://127.0.0.1:8080/jenkins
</span></a></span><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>; URL</span><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>保持不变
</span><span lang=EN-US><a href="http://yxz/jenkins"><span style='font-size:
10.5pt;mso-bidi-font-size:12.0pt'>http://yxz/jenkins</span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>注意程序要有相同的目录，目标服务器需要有<span
lang=EN-US>jenkins</span>目录。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.5.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>集群</h3>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
text-indent:24.0pt;mso-char-indent-count:2.0'>当页面的访问量非常大的时候，往往需要多个应用服务器来共同承担动态页面的执行操作，这时我们就需要使用集群的架构。<span
lang=EN-US> Nginx </span>通过<span lang=EN-US> upstream </span>指令来定义一个服务器的集群。</p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.5.2.1<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US>upstream </span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>配置</span></h4>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>upstream tomcats {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp; </span>server
127.0.0.1:80 weight=10;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;
</span>#server<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>127.0.0.1:81<span
style='mso-spacerun:yes'>&nbsp; </span>weight=10;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;
</span>server<span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>127.0.0.1:82 weight=10;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>代理跳转<span
lang=EN-US> proxy_pass </span>指令的写法变成了：</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
/ {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_pass<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>http://tomcats;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>X-Real-IP<span
style='mso-spacerun:yes'>&nbsp; </span>$remote_addr;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:18.0pt;mso-char-indent-count:1.5'>在<span
lang=EN-US> Nginx </span>的集群配置中，<span lang=EN-US>Nginx </span>使用最简单的平均分配规则给集群中的每个节点分配请求。一旦某个节点失效时，或者重新起效时，<span
lang=EN-US>Nginx </span>都会非常及时的处理状态的变化，以保证不会影响到用户的访问。</p>

<p class=MsoNormal style='text-indent:18.0pt;mso-char-indent-count:1.5'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>第二个例子<span
lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:18.0pt;mso-char-indent-count:1.5'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>upstream backend {</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server
backend1.example.com weight=5;</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server
127.0.0.1:8080<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>max_fails=3 fail_timeout=30s;</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server
unix:/tmp/backend3;</span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>}</span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>默认情况下，<span
lang=EN-US>nginx</span>按加权轮转的方式将请求分发到各服务器。 在上面的例子中，每<span lang=EN-US>7</span>个请求会通过以下方式分发：<span
lang=EN-US> 5</span>个请求分到<span lang=EN-US>backend1.example.com</span>， 一个请求分到第二个服务器，一个请求分到第三个服务器。
与服务器通信的时候，如果出现错误，请求会被传给下一个服务器，直到所有可用的服务器都被尝试过。 如果所有服务器都返回失败，客户端将会得到最后通信的那个服务器的（失败）响应结果。
</p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.5.2.2<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US>server</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>配置</span></h4>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='mso-cellspacing:0cm;mso-yfti-tbllook:1184'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>语法<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><strong><span lang=EN-US style='font-family:宋体;mso-bidi-font-family:
  宋体'>server</span></strong><code><span lang=EN-US> <i>address</i> [<i>parameters</i>];</span></code></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>默认值<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>— </span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>上下文<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><code><span lang=EN-US>upstream</span></code></p>
  </td>
 </tr>
</table>

<p>定义服务器的地址<code><i><span lang=EN-US>address</span></i></code>和其他参数<code><i><span
lang=EN-US>parameters</span></i></code>。 地址可以是域名或者<span lang=EN-US>IP</span>地址，端口是可选的，或者是指定<span
lang=EN-US>“<code>unix:</code>”</span>前缀的<span lang=EN-US>UNIX</span>域套接字的路径。如果没有指定端口，就使用<span
lang=EN-US>80</span>端口。 如果一个域名解析到多个<span lang=EN-US>IP</span>，本质上是定义了多个<span
lang=EN-US>server</span>。 </p>

<p>你可以定义下面的参数： </p>

<p class=MsoNormal><code><span lang=EN-US>weight</span></code><span lang=EN-US>=<code><i>number</i></code></span></p>

<p class=MsoNormal style='margin-left:36.0pt'>设定服务器的权重，默认是<span lang=EN-US>1</span>。
</p>

<p class=MsoNormal><code><span lang=EN-US>max_fails</span></code><span
lang=EN-US>=<code><i>number</i></code></span></p>

<p class=MsoNormal style='margin-left:36.0pt'>设定<span lang=EN-US>Nginx</span>与服务器通信的尝试失败的次数。在<code><span
lang=EN-US>fail_timeout</span></code>参数定义的时间段内，如果失败的次数达到此值，<span lang=EN-US>Nginx</span>就认为服务器不可用。在下一个<code><span
lang=EN-US>fail_timeout</span></code>时间段，服务器不会再被尝试。 失败的尝试次数默认是<span lang=EN-US>1</span>。设为<span
lang=EN-US>0</span>就会停止统计尝试次数，认为服务器是一直可用的。 你可以通过指令<span lang=EN-US><a
href="http://nginx.org/cn/docs/http/ngx_http_proxy_module.html#proxy_next_upstream">proxy_next_upstream</a></span>、
<span lang=EN-US><a
href="http://nginx.org/cn/docs/http/ngx_http_fastcgi_module.html#fastcgi_next_upstream">fastcgi_next_upstream</a></span>和
<span lang=EN-US><a
href="http://nginx.org/cn/docs/http/ngx_http_memcached_module.html#memcached_next_upstream">memcached_next_upstream</a></span>来配置什么是失败的尝试。
默认配置时，<code><span lang=EN-US>http_404</span></code>状态不被认为是失败的尝试。 </p>

<p class=MsoNormal><code><span lang=EN-US>fail_timeout</span></code><span
lang=EN-US>=<code><i>time</i></code></span></p>

<p class=MsoNormal style='margin-left:36.0pt'>设定 </p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:72.0pt;text-indent:-18.0pt;mso-list:l2 level1 lfo20;tab-stops:list 36.0pt'><![if !supportLists]><span
lang=EN-US style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>统计失败尝试次数的时间段。在这段时间中，服务器失败次数达到指定的尝试次数，服务器就被认为不可用。
</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:72.0pt;text-indent:-18.0pt;mso-list:l2 level1 lfo20;tab-stops:list 36.0pt'><![if !supportLists]><span
lang=EN-US style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>服务器被认为不可用的时间段。 </p>

<p class=MsoNormal style='margin-left:36.0pt'>默认情况下，该超时时间是<span lang=EN-US>10</span>秒。
</p>

<p class=MsoNormal><code><span lang=EN-US>backup</span></code></p>

<p class=MsoNormal style='margin-left:36.0pt'>标记为备用服务器。当主服务器不可用以后，请求会被传给这些服务器。 </p>

<p class=MsoNormal><code><span lang=EN-US>down</span></code></p>

<p class=MsoNormal style='margin-left:36.0pt'>标记服务器永久不可用，可以跟<span lang=EN-US><a
href="http://nginx.org/cn/docs/http/ngx_http_upstream_module.html#ip_hash">ip_hash</a></span>指令一起使用。
</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.6<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>反向代理负载均衡</span></h2>

<p class=MsoNormal><span lang=EN-US>nginx</span>通过<span lang=EN-US>upstream </span>指令完成负载均和和健康检查</p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.6.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
class=mw-headline><span lang=EN-US>Nginx</span>负载均衡基础知识</span></h3>

<p style='text-indent:6.0pt;mso-char-indent-count:.5'><span lang=EN-US>upstream</span>目前支持<span
lang=EN-US>5</span>种方式的分配 </p>

<p><b><span lang=EN-US>1)</span>、轮询（默认）</b> </p>

<p>每个请求按时间顺序逐一分配到不同的后端<span lang=EN-US><a
href="http://www.zzbaike.com/wiki/%E6%9C%8D%E5%8A%A1%E5%99%A8" title=服务器><span
lang=EN-US><span lang=EN-US>服务器</span></span></a></span>，如果后端服务器<span
lang=EN-US>down</span>掉，能自动剔除。 </p>

<p><b><span lang=EN-US>2)</span>、<span lang=EN-US>weight</span></b><span
lang=EN-US> </span></p>

<p>指定轮询几率，<span lang=EN-US>weight</span>和访问比率成正比，用于后端服务器性能不均的情况。 </p>

<p><b><span lang=EN-US>2)</span>、<span lang=EN-US>ip_hash</span></b><span
lang=EN-US> </span></p>

<p>每个请求按访问<span lang=EN-US><a href="http://www.zzbaike.com/wiki/Ip" title=Ip>ip</a></span>的<span
lang=EN-US>hash</span>结果分配，这样每个访客固定访问一个后端服务器，可以解决<span lang=EN-US>session</span>的问题。
</p>

<p><b><span lang=EN-US>3) fair</span>（第三方）</b> </p>

<p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。 </p>

<p><b><span lang=EN-US>4) url_hash</span>（第三方）</b> </p>

<p><b><span lang=EN-US>5) session stickess</span>（第三方）</b> </p>

<p><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.6.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
class=mw-headline><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;</span>Nginx </span>负载均衡实例<span
lang=EN-US>1</span></span></h3>

<pre><span lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:
gray-15 auto'>upstream <span style='mso-spacerun:yes'>&nbsp;</span>back_servers { <o:p></o:p></span></pre><pre><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;</span>server 127.0.0.1:9090 down;<o:p></o:p></span></pre><pre><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>server 127.0.0.1:8080 weight=2;<o:p></o:p></span></pre><pre><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>server 127.0.0.1:6060;<o:p></o:p></span></pre><pre><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>server 127.0.0.1:7070 backup;<o:p></o:p></span></pre>

<p><span lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:
gray-15 auto'>} </span><i style='mso-bidi-font-style:normal'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></i></p>

<p><i style='mso-bidi-font-style:normal'>每个</i>设备的状态设置为<span lang=EN-US>: </span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:18.0pt'><span lang=EN-US>a)down </span>表示单前的<span lang=EN-US>server</span>暂时不参与负载
</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:18.0pt'><span lang=EN-US>b)weight </span>默认为<span lang=EN-US>1.weight</span>越大，负载的权重就越大。
</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:18.0pt'><span lang=EN-US>c)max_fails&nbsp;:</span>允许请求失败的次数默认为<span
lang=EN-US>1.</span>当超过最大次数时，返回<span lang=EN-US>proxy_next_upstream </span>模块定义的错误
</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:18.0pt'><span lang=EN-US>d)fail_timeout:max_fails</span>次失败后，暂停的时间。
</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:18.0pt'><span lang=EN-US>e)backup</span>：其它所有的非<span lang=EN-US>backup</span>机器<span
lang=EN-US>down</span>或者忙的时候，请求<span lang=EN-US>backup</span>机器。所以这台机器压力会最轻。 <span
style='mso-spacerun:yes'>&nbsp;</span></p>

<p><span lang=EN-US>nginx</span>支持同时设置多组的负载均衡，用来给不用的<span lang=EN-US>server</span>来使用。
<span style='mso-spacerun:yes'>&nbsp;</span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>参考资料<span lang=EN-US><o:p></o:p></span></b></p>

<p><span lang=EN-US><a
href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html">http://nginx.org/en/docs/http/ngx_http_upstream_module.html</a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'> <o:p></o:p></span></p>

<p><span lang=EN-US><a
href="http://nginx.org/cn/docs/http/ngx_http_upstream_module.html"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://nginx.org/cn/docs/http/ngx_http_upstream_module.html</span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><o:p></o:p></span></p>

<p><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.7<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>客户端缓存</span>
</h2>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.7.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>Expires</span></h3>

<p class=MsoNormal>通过<span lang=EN-US>expires</span>指令来实现。</p>

<p class=MsoNormal>浏览器缓存静态资源，再次访问浏览器不发起新的请求。 </p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>不发起请求的几种方式：<span
lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l15 level1 lfo15'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>地址栏访问，不会向服务器发起请求</p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l15 level1 lfo15'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>关闭<span lang=EN-US>tab</span>，新开也不会重新访问。</p>

<p class=MsoListParagraph style='margin-left:36.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l15 level1 lfo15'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>关闭浏览器，重新打开也不会重新访问。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>配置<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US>location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span></p>

<p class=MsoNormal><span lang=EN-US>{</span></p>

<p class=MsoNormal><span lang=EN-US>expires 30d;</span></p>

<p class=MsoNormal><span lang=EN-US>}</span></p>

<p class=MsoNormal><span lang=EN-US>location ~ .*\.(js|css)?$</span></p>

<p class=MsoNormal><span lang=EN-US>{</span></p>

<p class=MsoNormal><span lang=EN-US>expires 1h;</span></p>

<p class=MsoNormal><span lang=EN-US>}</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_14"
 o:spid="_x0000_i1081" type="#_x0000_t75" style='width:402pt;height:70.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image011.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<pre>而下面的配置则定义了几种文件类型的请求处理方式。</pre><pre><span lang=EN-US>location ~ \.(htm|html|gif|jpg|jpeg|png|bmp|ico|css|js|txt)$ {</span></pre><pre><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>root /opt/webapp;</span></pre><pre><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>expires 24h;</span></pre><pre><span
lang=EN-US>}</span></pre>

<p>通过 <code><span lang=EN-US>expires</span></code><span lang=EN-US> </span>指令来控制其在浏览器的缓存，以减少不必要的请求。
<code><span lang=EN-US>expires</span></code><span lang=EN-US> </span>指令可以控制<span
lang=EN-US> HTTP </span>应答中的<span lang=EN-US>“ Expires ”</span>和<span
lang=EN-US>“ Cache-Control ”</span>的头标（起到控制页面缓存的作用）。您可以使用例如以下的格式来书写<span
lang=EN-US> Expires</span>：</p>

<pre><span lang=EN-US>expires 1 January, 1970, 00:00:01 GMT;</span></pre><pre><span
lang=EN-US>expires 60s;</span></pre><pre><span lang=EN-US>expires 30m;</span></pre><pre><span
lang=EN-US>expires 24h;</span></pre><pre><span lang=EN-US>expires 1d;</span></pre><pre><span
lang=EN-US>expires max;</span></pre><pre><span lang=EN-US>expires off;</span></pre>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>在服务端设置静态文件的<span
lang=EN-US>expire</span>参数是指 客户的本地浏览器缓存设置<span lang=EN-US>.</span></p>

<p class=MsoNormal>正值<span lang=EN-US>expire date = </span>当前时间<span
lang=EN-US> + </span>设置的<span lang=EN-US>time</span>时间，负值不缓存。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>4.7.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>缓存效果</h3>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_15"
 o:spid="_x0000_i1080" type="#_x0000_t75" style='width:415.5pt;height:248.25pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image012.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>4.7.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>刷新访问的结果</h3>

<p class=MsoNormal><span lang=EN-US>F5</span>刷新，会重新请求</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_17"
 o:spid="_x0000_i1079" type="#_x0000_t75" style='width:415.5pt;height:376.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image013.png" o:title=""/>
</v:shape></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.8<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>代理缓存</span></h2>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'><span
lang=EN-US>nginx</span>通过<span lang=EN-US>proxy_cache</span>指令来实现，当然还有其他几种通过<span
lang=EN-US>memcached</span>，通过<span lang=EN-US>ncache</span>。这种方式内置，也最成熟。适合从后端获取资源，然后存储。功能类似<span
lang=EN-US>squid</span>。<span lang=EN-US>Nginx</span>已经具备<span lang=EN-US>Squid</span>所拥有的<span
lang=EN-US>Web</span>缓存加速功能、清除指定<span lang=EN-US>URL</span>缓存的功能。而在性能上，<span
lang=EN-US>Nginx</span>对多核<span lang=EN-US>CPU</span>的利用，胜过<span lang=EN-US>Squid</span>不少。
另外，在反向代理、负载均衡、健康检查、后端服务器故障转移、<span lang=EN-US>Rewrite</span>重写、易用性上，<span
lang=EN-US>Nginx</span>也比<span lang=EN-US>Squid</span>强大得多。这使得一台<span
lang=EN-US>Nginx</span>可 以同时作为<span lang=EN-US>“</span>负载均衡服务器<span lang=EN-US>”</span>与<span
lang=EN-US>“Web</span>缓存服务器<span lang=EN-US>”</span>来使用。</p>

<h3 style='margin-left:0cm;text-indent:0cm;line-height:172%'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>4.8.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>proxy_cache</span></h3>

<p class=MsoNormal><span lang=EN-US>#</span>设置<span lang=EN-US>Web</span>缓存区名称为<span
lang=EN-US>cache_one</span>，内存缓存空间大小为<span lang=EN-US>200MB</span>，<span
lang=EN-US>1</span>天没有被访问的内容自动清除，硬盘缓存空间大小为<span lang=EN-US>30GB</span>。<span
lang=EN-US> &nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache_path
/data/proxy_cache_dir levels=1:2 keys_zone=cache_one:200m inactive=1d max_size=30g;
&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location /
&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>{ &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>如果后端的服务器返回<span lang=EN-US>502</span>、<span
lang=EN-US>504</span>、执行超时等错误，自动将请求转发到<span lang=EN-US>upstream</span>负载均衡池中的另一台服务器，实现故障转移。
<span lang=EN-US>&nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_next_upstream
http_502 http_504 error timeout invalid_header; &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache
cache_one; &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>对不同的<span lang=EN-US>HTTP</span>状态码设置不同的缓存时间<span
lang=EN-US> &nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache_valid
200 304 12h; &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>以域名、<span lang=EN-US>URI</span>、参数组合成<span
lang=EN-US>Web</span>缓存的<span lang=EN-US>Key</span>值，<span lang=EN-US>Nginx</span>根据<span
lang=EN-US>Key</span>值哈希，存储缓存内容到二级缓存目录内<span lang=EN-US> &nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache_key
$host$uri$is_args$args; &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header
Host $host; &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header
X-Forwarded-For $remote_addr; &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_pass
http://backend_server; &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>expires 1d;
&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>} &nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>定义缓存<span lang=EN-US>key</span>， 区域<span
lang=EN-US>allinpay</span>大小<span lang=EN-US>100m,</span>自动清除时间<span
lang=EN-US>1d,</span>磁盘缓存<span lang=EN-US>10<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache_path<span
style='mso-spacerun:yes'>&nbsp; </span>/data/nginx/cache
keys_zone=allinpay:100m;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_temp_path<span
style='mso-spacerun:yes'>&nbsp; </span>/data/nginx/temp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>&nbsp;&nbsp;#</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>注：<span lang=EN-US>proxy_temp_path</span>和<span
lang=EN-US>proxy_cache_path</span>指定的路径必须在同一分区<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>&nbsp;&nbsp;proxy_temp_path&nbsp;&nbsp;
/data0/proxy_temp_dir;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>&nbsp;&nbsp;#</span><span
style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>设置<span lang=EN-US>Web</span>缓存区名称为<span
lang=EN-US>cache_one</span>，内存缓存空间大小为<span lang=EN-US>200MB</span>，<span
lang=EN-US>1</span>天没有被访问的内容自动清除，硬盘缓存空间大小为<span lang=EN-US>30GB</span>。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>&nbsp;&nbsp;proxy_cache_path&nbsp;&nbsp;/data0/proxy_cache_dir&nbsp;&nbsp;levels=1:2&nbsp;&nbsp;
keys_zone=cache_one:200m inactive=1d max_size=30g;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache_path<span
style='mso-spacerun:yes'>&nbsp; </span>/data/nginx/cache
keys_zone=allinpay:100m;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_temp_path<span
style='mso-spacerun:yes'>&nbsp; </span>/data/nginx/temp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>[root@ippdev5 ~]# mkdir -p /data/nginx/</span></p>

<p class=MsoNormal><span lang=EN-US>[root@ippdev5 ~]# service nginx restart</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>常见问题<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l9 level1 lfo17'><![if !supportLists]><b
style='mso-bidi-font-weight:normal'><span lang=EN-US><span style='mso-list:
Ignore'>1.<span style='font:7.0pt "Times New Roman"'> </span></span></span></b><![endif]><b
style='mso-bidi-font-weight:normal'>启动错误<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US>nginx: [emerg] mkdir()
&quot;/data/nginx/cache&quot; failed (2: No such file or directory)</span></p>

<p class=MsoNormal><span lang=EN-US>nginx: configuration file
/etc/nginx/nginx.conf test failed</span></p>

<p class=MsoNormal>原因没有创建目录</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l20 level1 lfo13'><![if !supportLists]><b
style='mso-bidi-font-weight:normal'><span lang=EN-US><span style='mso-list:
Ignore'>2.<span style='font:7.0pt "Times New Roman"'> </span></span></span></b><![endif]><b
style='mso-bidi-font-weight:normal'>缓存默认时间<span lang=EN-US>10</span>分钟<span
lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US>If cached data is not requested for time
defined by the <b>inactive</b> parameter, than that data is removed from the
cache. The <b>inactive</b> parameter defaults to 10 minutes (<b>10m</b>).</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.8.1.1<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>proxy_cache_key</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>的</span><span lang=EN-US>2</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>种配法：</span></h4>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l21 level1 lfo16'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>通过浏览器获取的<span lang=EN-US>URL</span>做<span
lang=EN-US>KEY</span></p>

<p class=MsoNormal>域名：端口<span lang=EN-US>&nbsp;</span>浏览器完整地址（包括动态参数，如<span
lang=EN-US>:www.xxx.com:80/goods/1.html</span>）</p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_cache_key
&quot;$host:$server_port$request_uri&quot;;</span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l21 level1 lfo16'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>通过真实的<span lang=EN-US>URL</span>地址做<span
lang=EN-US>KEY</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span>域名：端口<span lang=EN-US>&nbsp;</span>真实请求地址（不是<span
lang=EN-US>rewrite</span>后的）<span lang=EN-US>&nbsp;?&nbsp;</span>参数</p>

<p class=MsoNormal><span lang=EN-US>(</span>如<span lang=EN-US>www.xxx.com:80/index.jsp?id=111)</span></p>

<p class=MsoNormal><span lang=EN-US>proxy_cache_key
&quot;$host:$server_port$uri$is_args$args&quot;;</span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>建议采用第一种
</p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.8.1.2<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>缓存效果</span></h4>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_18"
 o:spid="_x0000_i1078" type="#_x0000_t75" style='width:414.75pt;height:315.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image014.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_20"
 o:spid="_x0000_i1077" type="#_x0000_t75" style='width:415.5pt;height:303pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image015.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>全部缓存了 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_21"
 o:spid="_x0000_i1076" type="#_x0000_t75" style='width:415.5pt;height:246.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image016.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>重新加载<span lang=EN-US>jsp</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_23"
 o:spid="_x0000_i1075" type="#_x0000_t75" style='width:415.5pt;height:276.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image017.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>从缓存中加载</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_24"
 o:spid="_x0000_i1074" type="#_x0000_t75" style='width:415.5pt;height:253.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image018.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考资料</p>

<p class=MsoNormal><span lang=EN-US><a href="http://blog.s135.com/nginx_cache/">http://blog.s135.com/nginx_cache/</a><span
class=MsoHyperlink><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/meteoric_cry/archive/2011/05/14/2046263.html">http://www.cnblogs.com/meteoric_cry/archive/2011/05/14/2046263.html</a></span></p>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span lang=EN-US><a href="http://bbs.linuxtone.org/thread-7120-1-1.html">http://bbs.linuxtone.org/thread-7120-1-1.html</a><span
class=MsoHyperlink><span style='mso-spacerun:yes'>&nbsp; </span></span>nginx</span>缓存<span
lang=EN-US>cache</span>的几种方式 </p>

<p class=MsoNormal><span lang=EN-US><a
href="http://wiki.nginx.org/HttpProxyModule">http://wiki.nginx.org/HttpProxyModule</a><span
style='mso-spacerun:yes'>&nbsp; </span></span>参考大全 </p>

<p class=MsoNormal><span lang=EN-US><a
href="http://blog.chinaunix.net/uid-25018796-id-94903.html">http://blog.chinaunix.net/uid-25018796-id-94903.html</a><span
style='mso-spacerun:yes'>&nbsp; </span></span>详细配置<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html">http://nginx.org/en/docs/http/ngx_http_proxy_module.html</a><span
style='mso-spacerun:yes'>&nbsp; </span></span>参数详解</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.8.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>缓存路径计算</h3>

<p class=MsoNormal><span lang=EN-US><a
href="http://zhumeng8337797.blog.163.com/blog/static/10076891420142182952255/">http://zhumeng8337797.blog.163.com/blog/static/10076891420142182952255/</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><b><span style='font-size:10.5pt;
color:#2C2C2C'>先看<span lang=EN-US>proxy_cache_path&nbsp;</span>配置</span></b><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;color:#2C2C2C'>proxy_cache_path
&nbsp;/var/tmp/nginx/cache &nbsp;levels=1:2 &nbsp; keys_zone=cache_one:200m
inactive=1d max_size=30g;<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;color:#2C2C2C'>1</span><span style='font-size:10.5pt;
color:#2C2C2C'>，</span><span lang=EN-US style='font-size:10.5pt;font-family:
"Times New Roman","serif";color:#2C2C2C'>nginx</span><span style='font-size:
10.5pt;color:#2C2C2C'>反向代理缓存的目录为</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Times New Roman","serif";color:#2C2C2C'>/var/tmp/nginx/cache</span><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;color:#2C2C2C'>2</span><span style='font-size:10.5pt;
color:#2C2C2C'>，缓存文件的</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Times New Roman","serif";color:#2C2C2C'>key</span><span
style='font-size:10.5pt;color:#2C2C2C'>和其它信息放在一个</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>10M</span><span
style='font-size:10.5pt;color:#2C2C2C'>的共享内存中，命名为</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>one</span><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;color:#2C2C2C'>3</span><span style='font-size:10.5pt;
color:#2C2C2C'>，缓存文件最大占用</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Times New Roman","serif";color:#2C2C2C'>1G</span><span
style='font-size:10.5pt;color:#2C2C2C'>磁盘空间<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;color:#2C2C2C'>4</span><span style='font-size:10.5pt;
color:#2C2C2C'>，</span><span lang=EN-US style='font-size:10.5pt;font-family:
"Times New Roman","serif";color:#2C2C2C'>level=1:2<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>比如有一个</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>URL</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>是</span><span lang=EN-US style='font-size:
10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>http://www.libertyvps.com/1.png</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>，那么这个图片如果被缓存那他的路径就是</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>/</span><span lang=EN-US style='font-size:10.5pt;color:#2C2C2C'>var/tmp/nginx/cache</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>/9/ad/e0bd86606797639426a92306b1b98ad9<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>计算方法：</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>1)
nginx</span><span style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";
color:#2C2C2C'>先把请求地址</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Times New Roman","serif";color:#2C2C2C'>/1.png</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>用</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>md5</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>进行哈希，得到</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>e0bd86606797639426a92306b1b98ad9<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>2)
level=1:2</span><span style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";
color:#2C2C2C'>就是把最后一位数</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Times New Roman","serif";color:#2C2C2C'>9</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>拿出来建一个目录，然后再把</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>9</span><span style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";
color:#2C2C2C'>前面的</span><span lang=EN-US style='font-size:10.5pt;font-family:
"Times New Roman","serif";color:#2C2C2C'>2</span><span style='font-size:10.5pt;
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>位</span><span
style='font-size:10.5pt;color:#2C2C2C'>再</span><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>建一个目录，最后把刚才得到的这个缓存文件放到</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>9/ad</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>目录中。</span><span lang=EN-US style='font-size:
10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>同样的方法推理，如果</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>level=1:1</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>，那么缓存文件的路径就是</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>/</span><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'>var/tmp</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>/nginx/cache/9/d/e0bd86606797639426a92306b1b98ad9</span><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><b><span style='font-size:10.5pt;
mso-ascii-font-family:Tahoma;mso-hansi-font-family:Tahoma;mso-bidi-font-family:
Tahoma;color:#444444'>上面的例子只是最简单的</span></b><b><span lang=EN-US
style='font-size:10.5pt;font-family:"Tahoma","sans-serif";color:#444444'>URL</span></b><b><span
style='font-size:10.5pt;mso-bidi-font-family:Tahoma;color:#444444'>，如果带参数呢？</span></b><span
lang=EN-US style='color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>比如</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>http://www.libertyvps.com/1.png?v=1</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>，那么缓存路径还是一样吗？</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>先对比下这个两个配置</span><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>proxy_cache_key
$uri;</span><span lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>proxy_cache_key
$uri$is_args$args;<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>第一个配置只根据不带参的</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>$uri</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>进行哈希，所以这时候加了参数和没加参数是一样的结果；</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>第二个配置就是把域名之后所有的内容</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>(</span><span style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";
color:#2C2C2C'>也就是</span><span lang=EN-US style='font-size:10.5pt;font-family:
"Times New Roman","serif";color:#2C2C2C'>$request_uri)</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>都进行哈希。</span><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span style='font-size:10.5pt;
mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>说明：</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>1)
MD5</span><span style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";
color:#2C2C2C'>哈希过之后的路径是十六进制的，对于</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Times New Roman","serif";color:#2C2C2C'>nignx</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>来说查询速度更快；</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>2)
level=1:2</span><span style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";
color:#2C2C2C'>会比</span><span lang=EN-US style='font-size:10.5pt;font-family:
"Times New Roman","serif";color:#2C2C2C'>level=1:1</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>建立更多的目录，适合缓存海量文件，因为单个目录下的文件太多会降低</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>IO</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>性能；</span><span lang=EN-US style='font-size:
10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>3)&nbsp;</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>缓存会先被写入写入临时文件，所以建议</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>proxy_cache_path</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>和</span><span lang=EN-US style='font-size:
10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>proxy_temp_path</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>放在同一个文件系统当中；</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='font-size:10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>4)&nbsp;</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>虽然</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>nginx</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>有通过</span><span lang=EN-US style='font-size:
10.5pt;font-family:"Times New Roman","serif";color:#2C2C2C'>HTTP</span><span
style='font-size:10.5pt;mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>协议删除缓存的第三方插件，但是我考虑之后觉得还是不用的好。</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>nginx</span><span style='font-size:10.5pt;mso-bidi-font-family:
"Times New Roman";color:#2C2C2C'>的缓存本来就不是很成熟，外加一个第三方插件就更不让人放心了</span><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_43"
 o:spid="_x0000_i1073" type="#_x0000_t75" style='width:415.5pt;height:318pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image019.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.8.3<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>缓存命中率</h3>

<p class=MsoNormal><span lang=EN-US><a
href="http://lmdkfs.blog.163.com/blog/static/74611324201421283237778/">http://lmdkfs.blog.163.com/blog/static/74611324201421283237778/</a></span></p>

<p class=MsoNormal style='line-height:21.0pt'><b><span style='font-size:10.5pt;
color:#2C2C2C'>查看命中的缓存</span></b><span lang=EN-US style='font-size:10.5pt;
color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><b><span lang=EN-US
style='font-size:10.5pt;color:#2C2C2C'>1</span></b><b><span style='font-size:
10.5pt;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman";
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>、在</span></b><b><span
lang=EN-US style='font-size:10.5pt;font-family:"Times New Roman","serif";
color:#2C2C2C'>http header</span></b><b><span style='font-size:10.5pt;
mso-bidi-font-family:"Times New Roman";color:#2C2C2C'>上增加命中显示</span></b><span
lang=EN-US style='font-size:10.5pt;color:#2C2C2C'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;mso-bidi-font-family:"Times New Roman"'>nginx</span><span
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;mso-bidi-font-family:"Times New Roman"'>提供了<span lang=EN-US>$upstream_cache_status</span>这个变量来显示缓存的状态，我们可以在配置中添加一个<span
lang=EN-US>http</span>头来显示这一状态，达到类似<span lang=EN-US>squid</span>的效果。</span><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;mso-bidi-font-family:"Times New Roman"'>location &nbsp;/ {</span><span
lang=EN-US style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast'> <o:p></o:p></span></p>

<p class=MsoNormal style='line-height:21.0pt'><span lang=EN-US
style='mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast'>#Nginx_Cache</span><span style='mso-ascii-font-family:宋体;
mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast'>名称任意<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><strong><i><span lang=EN-US style='font-family:宋体;
mso-ascii-theme-font:minor-fareast;mso-fareast-theme-font:minor-fareast;
mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:宋体;background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>add_header &nbsp;
&nbsp;&nbsp;Nginx-Cache&nbsp;&nbsp;&nbsp;“$upstream_cache_status”;<o:p></o:p></span></i></strong></p>

<p class=MsoNormal><strong><i><span lang=EN-US style='font-family:宋体;
mso-bidi-font-family:宋体;color:olive'><o:p>&nbsp;</o:p></span></i></strong></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_40"
 o:spid="_x0000_i1072" type="#_x0000_t75" style='width:346.5pt;height:181.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image020.png" o:title=""/>
</v:shape></span><strong><i><span lang=EN-US style='font-family:宋体;mso-bidi-font-family:
宋体;color:olive'><o:p></o:p></span></i></strong></p>

<p class=MsoNormal><strong><i><span lang=EN-US style='font-family:宋体;
mso-bidi-font-family:宋体;color:olive'><o:p>&nbsp;</o:p></span></i></strong></p>

<p class=MsoNormal><strong><i><span lang=EN-US style='font-family:宋体;
mso-bidi-font-family:宋体'><o:p>&nbsp;</o:p></span></i></strong></p>

<p class=MsoNormal><strong><span style='font-family:宋体;mso-bidi-font-family:
宋体;font-weight:normal;mso-bidi-font-weight:bold;mso-bidi-font-style:italic'>日志<span
lang=EN-US><o:p></o:p></span></span></strong></p>

<p class=MsoNormal><span lang=EN-US>log_format&nbsp;&nbsp; </span>添加变量 <span
class=string><span lang=EN-US>&quot;$upstream_cache_status&quot;</span></span></p>

<p class=MsoNormal><strong><i><span lang=EN-US style='font-family:宋体;
mso-bidi-font-family:宋体'><o:p>&nbsp;</o:p></span></i></strong></p>

<p class=MsoNormal>统计方法：用<span lang=EN-US>HIT</span>的数量除以日志总量得出缓存命中率</p>

<p class=MsoNormal><span lang=EN-US>awk&nbsp;<span class=string>'{if($NF==&quot;\&quot;HIT\&quot;&quot;)&nbsp;hit++}&nbsp;END&nbsp;{printf&nbsp;&quot;%.2f%&quot;,hit/NR}'</span>&nbsp;access.log&nbsp;&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US>$upstream_cache_status</span>包含以下几种状态： </p>

<p class=MsoNormal><span lang=EN-US>·MISS </span>未命中，请求被传送到后端 </p>

<p class=MsoNormal><span lang=EN-US>·HIT </span>缓存命中 </p>

<p class=MsoNormal><span lang=EN-US>·EXPIRED </span>缓存已经过期请求被传送到后端 </p>

<p class=MsoNormal><span lang=EN-US>·UPDATING </span>正在更新缓存，将使用旧的应答 </p>

<p class=MsoNormal><span lang=EN-US>·STALE </span>后端将得到过期的应答</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span>统计日志脚本：</p>

<p class=MsoNormal><span lang=EN-US>1. </span>每天<span lang=EN-US>0</span>点切割<span
lang=EN-US>nginx</span>日志</p>

<p class=MsoNormal><span lang=EN-US>2. </span>将每日的缓存统计存入日志以供参考</p>

<p class=MsoNormal><span lang=EN-US># crontab –l</span></p>

<p class=MsoNormal><span lang=EN-US>1 0 * * * /opt/shell/nginx_cache_hit
&gt;&gt; /usr/local/openresty/nginx/logs/hit</span></p>

<p class=MsoNormal><span lang=EN-US># cat /opt/shell/nginx_cache_hit</span></p>

<p class=MsoNormal><span lang=EN-US>#!/bin/bash</span></p>

<p class=MsoNormal><span lang=EN-US>LOG_FILE=’/usr/local/nginx/logs/access.log.1′</span></p>

<p class=MsoNormal><span lang=EN-US>LAST_DAY=$(date +%F -d “-1 day”)</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt'>awk
‘{if($NF==”\”HIT\”&quot;) hit++} END {printf “‘$LAST_DAY’: %d %d %.2f%\n”,
hit,NR,hit/NR}’ $LOG_FILE<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.8.4<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>使用内存作为文件系统</h3>

<p class=MsoNormal><span lang=EN-US>nginx</span>本身不提供缓存到内存的功能，不过可以通过使用技巧来做，就是通过内存文件系统来实现。
<span lang=EN-US>/dev/shm</span>为默认虚拟内存。 ，可以自定义一个虚拟文件系统。</p>

<p class=MsoNormal>自定义一个虚拟文件系统</p>

<p class=MsoNormal><span lang=EN-US>mkdir –p /data/nginx</span></p>

<p class=MsoNormal><span lang=EN-US>mount nginx_fs /data/nginx -t tmpfs -o
size=100m</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_26"
 o:spid="_x0000_i1071" type="#_x0000_t75" style='width:415.5pt;height:109.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image021.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>测试读写速度</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_27"
 o:spid="_x0000_i1070" type="#_x0000_t75" style='width:415.5pt;height:48pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image022.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>注意：</p>

<p class=MsoNormal>自定义的内存文件系统，重启丢失。</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>开机自启动 <span
lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal>编辑<span lang=EN-US>vi /etc/fstabl</span></p>

<p class=MsoNormal><span lang=EN-US>nginx<span style='mso-spacerun:yes'>&nbsp;
</span>/data/nginx<span style='mso-spacerun:yes'>&nbsp; </span>tmpfs<span
style='mso-spacerun:yes'>&nbsp; </span>size=200m 0 0</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_59"
 o:spid="_x0000_i1069" type="#_x0000_t75" style='width:415.5pt;height:103.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image023.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>综合起来可以简单优化静态文件：<span
lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>location ~ .*\.(js|css|gif|jpg|jpeg|png|bmp|swf|flv)$<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; proxy_pass http://backend;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; expires 6h; #</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>设置浏览器过期时间<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; proxy_cache allinpay;#</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>使用<span
lang=EN-US>allinpay</span>这个<span lang=EN-US>keys_zone<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; proxy_cache_valid 200 302 1h;#200</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>和<span
lang=EN-US>302</span>状态码保存<span lang=EN-US>1</span>小时<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; proxy_cache_valid 301 1d;#301</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>状态码保存一天<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; proxy_cache_valid any 1m;#</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>其它的保存一分钟<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>&nbsp; &nbsp; } </span></p>

<p class=MsoNormal>参考</p>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'><span
lang=EN-US><a href="http://blog.csdn.net/han_dongwei/article/details/12709323">http://blog.csdn.net/han_dongwei/article/details/12709323</a><span
class=linktitle> <span style='mso-spacerun:yes'>&nbsp;</span></span><a
href="http://blog.csdn.net/han_dongwei/article/details/12709323">nginx cache<span
lang=EN-US><span lang=EN-US>静态化+tmpfs </span></span><span lang=EN-US><span
lang=EN-US>高性能cdn</span></span><span lang=EN-US><span lang=EN-US>方案</span></span><span
lang=EN-US><span lang=EN-US> </span></span><span lang=EN-US><span lang=EN-US>原创-</span></span><span
lang=EN-US><span lang=EN-US>胡志广</span></span><span lang=EN-US><span lang=EN-US>
</span></span></a></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.8.5<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>清空缓存
</h3>

<p class=MsoNormal><span lang=EN-US>PROXY_CACHE</span>更新缓存必须依赖于<span
lang=EN-US>mod_purge</span>或者删除相应的缓存目录<span lang=EN-US>,</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp; </span>无需重启<span lang=EN-US>nginx</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="https://192.168.1.75/purge/idemo/inc/images/reddot.gif">https://192.168.1.75/purge/idemo/inc/images/reddot.gif</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>location ~
/purge(/.*) &nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>{ &nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>#</span>设置只允许指定的<span
lang=EN-US>IP</span>或<span lang=EN-US>IP</span>段输入正确的密码才可以清除<span lang=EN-US>URL</span>缓存。<span
lang=EN-US>(Nginx </span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>allow 127.0.0.1;
&nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>allow
192.168.1.0/24; &nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>deny all; &nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>proxy_cache_purge
cache_one $host$1$is_args$args; &nbsp;</span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US>} &nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;#</span>用于清除缓存<span lang=EN-US>,</span>假设一个<span
lang=EN-US>URL</span>为<span lang=EN-US>http://192.168.4.178/test.gif,</span>通过访问</p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;#http://192.168.4.178/purge/test.gif</span>可以清楚该<span
lang=EN-US>url</span>的缓存</p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;location&nbsp;~&nbsp;/purge(/.*)</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</span>设置值允许指定的<span
lang=EN-US>ip</span>或<span lang=EN-US>ip</span>段才可以清除<span lang=EN-US>URL</span>缓存</p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow&nbsp;127.0.0.1</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow&nbsp;192.168.0.0/16;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deny&nbsp;all;</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_cache_purge&nbsp;cache_one&nbsp;$host$1$is_args$args</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;access_log&nbsp;off;</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>需要编译</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>[root@ippdev5 nginx]# vi
/etc/nginx/conf.d/default.conf </span></p>

<p class=MsoNormal><span lang=EN-US>[root@ippdev5 nginx]# service nginx restart</span></p>

<p class=MsoNormal><span lang=EN-US>nginx: [emerg] unknown directive
&quot;proxy_cache_purge&quot; in /etc/nginx/conf.d/default.conf:56</span></p>

<p class=MsoNormal><span lang=EN-US>nginx: configuration file
/etc/nginx/nginx.conf test failed</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>注意表达式顺序，要把<span lang=EN-US>purge</span>放在<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span></span>缓存前面才能匹配</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_47"
 o:spid="_x0000_i1068" type="#_x0000_t75" style='width:411.75pt;height:91.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image024.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_45"
 o:spid="_x0000_i1067" type="#_x0000_t75" style='width:415.5pt;height:171.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image025.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal>再次访问，</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_46"
 o:spid="_x0000_i1066" type="#_x0000_t75" style='width:413.25pt;height:173.25pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image026.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.9<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US style='font-size:10.5pt;
mso-bidi-font-size:16.0pt;line-height:173%'><span
style='mso-spacerun:yes'>&nbsp;</span></span><span lang=EN-US>fast cgi</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>工作模式</span></h2>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>以<span
lang=EN-US>php</span>为例，其他的<span lang=EN-US>perl</span>、<span lang=EN-US>python</span>类似<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>FastCGI </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>访问<span lang=EN-US>php-cgi<o:p></o:p></span></span></b></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>为了解决<span
lang=EN-US>cgi</span>，每次访问都要创建一个进程的不足。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>引入来的<span
lang=EN-US>fastcgi</span>，充当一个线程池，每次访问都从线程池中取。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;</span>location ~ \.php$ {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>#</span><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>这个<span
lang=EN-US>root</span>需要设置对<span lang=EN-US>,</span>绝对路径没有问题，但是虚拟目录有问题。不知道如何设置<span
lang=EN-US>script<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>root<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>d:/myweb;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>fastcgi_pass<span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span>127.0.0.1:9000;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>fastcgi_index<span style='mso-spacerun:yes'>&nbsp; </span>index.php;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>fastcgi_param<span style='mso-spacerun:yes'>&nbsp;
</span>SCRIPT_FILENAME<span style='mso-spacerun:yes'>&nbsp;
</span>d:/myweb$fastcgi_script_name;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>include<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>fastcgi_params;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>实际<span
lang=EN-US>php</span>的应用在<span lang=EN-US>d:/myweb/mywiki</span>下。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>虚拟目录中配置<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>虚拟目录<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='mso-spacerun:yes'>&nbsp;</span>location /wiki {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>alias d:/myweb/mywiki;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>index<span style='mso-spacerun:yes'>&nbsp; </span>index.php index.html
index.htm ;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>对应的脚本路径<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>location ~ ^/wiki/.+\.php$ {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>root d:/myweb/mywiki;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>rewrite /wiki/(.*\.php?) /$1 break;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>#include fcgi.conf;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>include<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>fastcgi_params;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>fastcgi_pass 127.0.0.1:9000;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>fastcgi_index index.php;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>fastcgi_param SCRIPT_FILENAME d:/myweb/mywiki$fastcgi_script_name;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><span style='mso-spacerun:yes'>&nbsp;</span><span
style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>常见配置错误<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>1. fast-cgi</span><span style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>没有找到<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>2. fast-cgi</span><span style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>配置好了，但是脚本路径不对，提示如下错误。<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>访问<span
lang=EN-US>php</span>文件，却报<span lang=EN-US>No input file specified.<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>3. 504</span><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>错误<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>Fastcgi_pass<span style='mso-spacerun:yes'>&nbsp; </span></span><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>和<span lang=EN-US>php-cgi</span>开启的端口不一致<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>PHP</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>支持<span lang=EN-US>FastCGI</span>方式<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>在<span
lang=EN-US>php.ini</span>开启<span lang=EN-US> cgi.fix_pathinfo=1<o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>以<span
lang=EN-US>cgi</span>方式允许<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>D:\php-5.3.8-nts-Win32-VC9-x86&gt;php-cgi.exe -b 127.0.0.1:9000 -c
D:\php-5.3.8-nts-Win32-VC9-x86\php.ini<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>这个比较变态<span
lang=EN-US> php-cgi</span>结束进程，端口也不释放，需要强制关闭才行（<span lang=EN-US>cport)<o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>查看端口是否占用<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>The page you are looking for is temporarily unavailable.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>Please try again later. <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>PHP</span><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>虚拟目录的问题<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>虚拟目录<span
lang=EN-US>php-fastcgi</span>的支持<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>参考 </span><span
lang=EN-US><a href="http://mengdejun.iteye.com/blog/98560"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://mengdejun.iteye.com/blog/98560</span></a></span><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>解析脚本路径错误，问题原因<span
lang=EN-US>nginx</span>提供的脚本路径<span lang=EN-US>php fastcgi</span>进程找不到对应的目录和文件。
<span style='mso-spacerun:yes'>&nbsp;</span><span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>参考资料<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal><span lang=EN-US>http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html</span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.10<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>Nginx</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>处理</span><span lang=EN-US> JAVA</span></h2>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.10.1<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>代理方式</h3>

<p class=MsoNormal>访问动态页面的过程，通过代理模式访问后端。这种比较常见<span lang=EN-US>.</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="_x0000_i1065"
 type="#_x0000_t75" style='width:415.5pt;height:245.25pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image027.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_6"
 o:spid="_x0000_i1064" type="#_x0000_t75" style='width:415.5pt;height:268.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image028.png" o:title=""/>
</v:shape></span><a name="_GoBack"></a></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.10.2<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>反向代理集群方式</h3>

<p class=MsoNormal>参考前面集群的方式</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_65"
 o:spid="_x0000_i1063" type="#_x0000_t75" style='width:219.75pt;height:64.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image029.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_64"
 o:spid="_x0000_i1062" type="#_x0000_t75" style='width:354pt;height:204pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image030.png" o:title=""/>
</v:shape></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.10.3<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US>nginx_upstream_jvm_route </span></h3>

<p class=MsoNormal style='text-indent:24.0pt;mso-char-indent-count:2.0'>这个模块的功能是<span
lang=EN-US>nginx</span>把客户端请求发送同一个<span lang=EN-US>session</span>服务器中，也就是说<span
lang=EN-US>nginx</span>具有粘性。</p>

<p class=MsoNormal><span lang=EN-US>ip_hash</span>也有粘性，但是负责不能均衡，如果是同一地区访问，都是一个<span
lang=EN-US>ip</span>地址，会造成有的服务器压力大，有的服务器压力小。</p>

<p class=MsoNormal>注意的问题是，如果有多个<span lang=EN-US>nginx</span>服务器，显然不可用的，还有一个就是这个是对<span
lang=EN-US>nginx</span>直接打补丁，新版本需要测试。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>打补丁</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:#EEEEEE'><span lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";
color:black'>cd nginx</span><span lang=EN-US style='font-size:9.0pt;font-family:
"Lucida Console";color:#666600'>-</span><span lang=EN-US style='font-size:9.0pt;
font-family:"Lucida Console";color:#006666'>0.7</span><span lang=EN-US
style='font-size:9.0pt;font-family:"Lucida Console";color:#666600'>.</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#006666'>59</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:black'> </span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#880000'>#
or whatever</span><span lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";
color:black'><br>
patch </span><span lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";
color:#666600'>-</span><span lang=EN-US style='font-size:9.0pt;font-family:
"Lucida Console";color:black'>p0 </span><span lang=EN-US style='font-size:9.0pt;
font-family:"Lucida Console";color:#666600'>&lt;</span><span lang=EN-US
style='font-size:9.0pt;font-family:"Lucida Console";color:black'> </span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#008800'>/path/</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:black'>to</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#666600'>/</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#000088'>this</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#666600'>/</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:black'>directory</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#666600'>/</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:black'>jvm_route</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:#666600'>.</span><span
lang=EN-US style='font-size:9.0pt;font-family:"Lucida Console";color:black'>patch<o:p></o:p></span></p>

<p class=MsoNormal>编译</p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'># ./configure --prefix=/usr/nginx-0.8.1 --with-http_stub_status_module
--add-module=/path/to/this/directory/<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>#make<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>#make install<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>以下配置：</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>1. Resin:</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>upstream backend {</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.100
srun_id=a;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.101
srun_id=b;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.102
srun_id=c;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.103
srun_id=d;</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>jvm_route
$cookie_JSESSIONID;</span></p>

<p class=MsoNormal><span lang=EN-US>}</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>2. Tomcat:</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>upstream backend {</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.100
srun_id=a;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.101
srun_id=b;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.102
srun_id=c;</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server 192.168.0.103
srun_id=d; </span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>jvm_route $cookie_JSESSIONID
reverse;</span></p>

<p class=MsoNormal><span lang=EN-US>}</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考资料：<span lang=EN-US>http://code.google.com/p/nginx-upstream-jvm-route/</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.11<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>日志</span></h2>

<p class=MsoNormal>指令格式</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='mso-cellspacing:0cm;mso-yfti-tbllook:1184'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>语法<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><b><span lang=EN-US>access_log</span></b><span lang=EN-US>
  <i>path</i> [<i>format</i> [buffer=<i>size</i>]];<br>
  <b>access_log</b> off;</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>默认值<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
  lang=EN-US>access_log logs/access.log combined;</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal align=center style='text-align:center'><b>上下文<span
  lang=EN-US>: <o:p></o:p></span></b></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>http, server, location, if in location,
  limit_except</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考</p>

<p class=MsoNormal><span lang=EN-US>http://nginx.org/en/docs/http/ngx_http_log_module.html</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://nginx.org/cn/docs/http/ngx_http_log_module.html">http://nginx.org/cn/docs/http/ngx_http_log_module.html</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.12<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>监控状态</span></h2>

<p class=MsoNormal>参考 <span lang=EN-US><a
href="http://wiki.nginx.org/HttpStubStatusModule">http://wiki.nginx.org/HttpStubStatusModule</a></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
/nginx_status {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp; </span>stub_status on;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>开启状态监控<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp; </span>access_log<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>off; #</span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>关闭访问日志<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp; </span>allow SOME.IP.ADD.RESS;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>白名单<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp; </span>deny all;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>黑名单<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p><b style='mso-bidi-font-weight:normal'>得到的页面如下：<span lang=EN-US><o:p></o:p></span></b></p>

<p><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>Active connections:
291<o:p></o:p></span></p>

<pre><span lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>server accepts handled requests<o:p></o:p></span></pre><pre><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:
#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp; </span>16630948 16630948 31070465<o:p></o:p></span></pre><pre><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:
#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>Reading: 6 Writing: 179 Waiting: 106<o:p></o:p></span></pre><pre><span
lang=EN-US style='font-size:9.0pt;font-family:"微软雅黑","sans-serif";background:
#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></pre>

<p class=MsoNormal><span lang=EN-US>Active connections<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>//</span>当前<span lang=EN-US>
Nginx </span>正处理的活动连接数。</p>

<p class=MsoNormal><span lang=EN-US>server accepts handled requests //</span>总共处理了<span
lang=EN-US>8 </span>个连接<span lang=EN-US> , </span>成功创建<span lang=EN-US> 8 </span>次握手<span
lang=EN-US>,</span>总共处理了<span lang=EN-US>500</span>个请求。</p>

<p class=MsoNormal><span lang=EN-US>Reading //nginx </span>读取到客户端的<span
lang=EN-US> Header </span>信息数。</p>

<p class=MsoNormal><span lang=EN-US>Writing //nginx </span>返回给客户端的<span
lang=EN-US> Header </span>信息数。</p>

<p class=MsoNormal><span lang=EN-US>Waiting //</span>开启<span lang=EN-US>
keep-alive </span>的情况下，这个值等于<span lang=EN-US> active - (reading + writing)</span>，意思就是<span
lang=EN-US> Nginx </span>已经处理完正在等候下一次请求指令的驻留连接</p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.13<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>文件编码</span></h2>

<p class=MsoNormal>指定服务器文件输出的编码格式</p>

<p class=MsoNormal>如果使用请使用<span lang=EN-US>utf-8,source_charset</span>不设置或者也使用<span
lang=EN-US>utf-8</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='mso-cellspacing:0cm;mso-yfti-tbllook:1184'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>syntax: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><strong><span lang=EN-US style='font-family:宋体;mso-bidi-font-family:
  宋体'>charset</span></strong><code><span lang=EN-US> <i>charset</i> | off;</span></code></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>default: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>charset off;<span
  style='mso-spacerun:yes'>&nbsp; </span>#</span>默认不转换</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>Ccontext: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><code><span lang=EN-US>http</span></code><span lang=EN-US>,
  <code>server</code>, <code>location</code>, <code>if in location</code></span></p>
  </td>
 </tr>
</table>

<p><span lang=EN-US>Adds the specified charset to the “Content-Type” response
header field. If this charset is different from the charset specified in the <a
href="http://nginx.org/en/docs/http/ngx_http_charset_module.html#source_charset">source_charset</a>
directive, a conversion is performed. </span></p>

<p><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p>请求返回的编码</p>

<p><span lang=EN-US>The parameter <code>off</code> cancels the addition of
charset to the “Content-Type” response header field.</span></p>

<p><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span>nginx</span>对编码转换支持的不好，所以不要使用这个转换。</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_11"
 o:spid="_x0000_i1061" type="#_x0000_t75" style='width:261pt;height:130.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image031.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_12"
 o:spid="_x0000_i1060" type="#_x0000_t75" style='width:415.5pt;height:26.25pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image032.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal>参考</p>

<p class=MsoNormal><span lang=EN-US><a
href="http://nginx.org/en/docs/http/ngx_http_charset_module.html#source_charset">http://nginx.org/en/docs/http/ngx_http_charset_module.html#source_charset</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.14<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>请求超时</span></h2>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='mso-cellspacing:0cm;mso-yfti-tbllook:1184'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>syntax: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><b><span lang=EN-US>keepalive_requests</span></b><span
  lang=EN-US> <i>number</i>;</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>default: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
  lang=EN-US>keepalive_requests 100;</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>context: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>http, server, location</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>This directive appeared in version 0.8.0. </span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>Sets the maximum number of requests that can be served through one
keep-alive connection. After the maximum number of requests are made, the
connection is closed. </span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='mso-cellspacing:0cm;mso-yfti-tbllook:1184'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><a name="keepalive_timeout"></a><span lang=EN-US>syntax: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><b><span lang=EN-US>keepalive_timeout</span></b><span
  lang=EN-US> <i>timeout</i> [<i>header_timeout</i>];</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>default: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
  lang=EN-US>keepalive_timeout 75s;</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes'>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>context: </span></p>
  </td>
  <td style='padding:.75pt .75pt .75pt .75pt'>
  <p class=MsoNormal><span lang=EN-US>http, server, location</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>The first parameter sets a timeout during which a keep-alive client
connection will stay open on the server side. The zero value disables
keep-alive client connections. The optional second parameter sets a value in
the “Keep-Alive: timeout=<i>time</i>” response header field. Two parameters may
differ. </span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.15<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>客户端流量</span><span
lang=EN-US>&nbsp;</span><span style='font-family:宋体;mso-ascii-font-family:Cambria;
mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>限制</span></h2>

<p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span>通过以下两条命令来完成。<span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'><b style='mso-bidi-font-weight:
normal'>指令名称：<span lang=EN-US>limit_rate</span></b></p>

<p class=MsoNormal style='margin-left:60.0pt;text-indent:-60.0pt;mso-char-indent-count:
-5.0;mso-line-height-alt:0pt'>功<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>能：该指令用于指定向客户端传输数据的速度，速度的单位是每秒传输的字节数。需要明白的一点是该限制只是针对一个连接的设定，就是说如果同时有两个连接那么它的速度将会是该指令设置值的<span
lang=EN-US>2</span>倍，</p>

<p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'>如果需要在<span lang=EN-US>server</span>级别对某些客户端限制速度，对于这种情况——这个指令可能并不适合，但是可设置<span
lang=EN-US>$limit_rate</span>变量，可以为该变量传递相应的值来实现，例如：</p>

<p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US>&nbsp;</span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0
 style='margin-left:23.4pt;background:#E6E6E6;border-collapse:collapse;
 border:none;mso-border-alt:solid windowtext .5pt;mso-yfti-tbllook:1184;
 mso-padding-alt:0cm 5.4pt 0cm 5.4pt;mso-border-insideh:.5pt solid windowtext;
 mso-border-insidev:.5pt solid windowtext'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:7.45pt'>
  <td width=504 valign=top style='width:378.35pt;border:solid windowtext 1.0pt;
  mso-border-alt:solid windowtext .5pt;background:transparent;padding:0cm 5.4pt 0cm 5.4pt;
  height:7.45pt'>
  <p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US>server {</span></p>
  <p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US><span
  style='mso-spacerun:yes'>&nbsp; </span>if ($slow) {</span></p>
  <p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US><span
  style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>set $limit_rate<span
  style='mso-spacerun:yes'>&nbsp; </span>4k;</span></p>
  <p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US><span
  style='mso-spacerun:yes'>&nbsp; </span>}</span></p>
  <p class=MsoNormal style='mso-line-height-alt:7.45pt'><span lang=EN-US>}</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>当然也可以通过设置<span
lang=EN-US>X-Accel-Limit-Rate</span>头<span lang=EN-US>(</span>来自于<span
lang=EN-US>NginxXSendfile</span>模块<span lang=EN-US>)</span>来控制由<span
lang=EN-US>proxy_pass(</span>来自于<span lang=EN-US>HttpProxyModule</span>模块<span
lang=EN-US>)</span>返回的响应数据的速率，而没有使用<span lang=EN-US>X-Accel-Redirect</span>头。</p>

<p class=MsoNormal style='mso-line-height-alt:0pt'>语<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>法<span lang=EN-US>:
limit_rate speed </span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'>默 认 值<span lang=EN-US>: no </span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'>使用环境<span lang=EN-US>: http,
server, location, if in location </span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'><b style='mso-bidi-font-weight:
normal'>指<span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span></span>令：<span lang=EN-US>limit_rate_after</span></b></p>

<p class=MsoNormal style='margin-left:60.0pt;text-indent:-60.0pt;mso-char-indent-count:
-5.0;mso-line-height-alt:0pt'><span style='mso-ascii-font-family:"Times New Roman";
mso-hansi-font-family:"Times New Roman"'>功</span><span lang=EN-US
style='font-family:"Times New Roman","serif"'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>能：</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>limit_rate_after</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，这个命令中的“</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>after</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>”提示了我们，可以这样理解“在</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>…</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>后再限制速率为</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>…</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>”，没错，就是这个意思，它的语法为：</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>limit_rate_after time(</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>这是官方威客上</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>http://wiki.nginx.org/HttpCoreModule#limit_rate</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的语法</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>)</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>，它的意思是以最大的速度下载</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>time</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>时长后，但是在实际的使用中发现命令</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>limit_rate_after</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>的参数是一个下载字节量的大小值，而不是时间值，因此上面的命令“</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>limit_rate_after 3m</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>”解释为：以最大的速度下载</span><span
lang=EN-US style='font-family:"Times New Roman","serif"'>3M</span><span
style='mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'>后。</span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'>语 <span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;</span></span>法：<span lang=EN-US>limit_rate_after
size </span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'>默 认 值：<span lang=EN-US>limit_rate_after
1m </span></p>

<p class=MsoNormal style='mso-line-height-alt:0pt'>使用字段：<span lang=EN-US>http,
server, location, location</span>中的<span lang=EN-US>if</span>字段 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>4.16<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>HTTPS</span></h2>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.16.1<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US>https</span>设置</h3>

<p class=MsoNormal>主要增加了证书设置</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l18 level1 lfo19'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>生成证书</p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>yum install openssl openssl-devel<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>openssl genrsa -des3 -out allinpay.key 2048<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>opensll req -new -key allinpay.key -out allinpay.csr<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>openssl x509 -req<span
style='mso-spacerun:yes'>&nbsp; </span>-days 365 -in allinpay.csr<span
style='mso-spacerun:yes'>&nbsp; </span>-signkey allinpay.key -out allinpay.crt<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l18 level1 lfo19'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>配置</p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>server {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>listen<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>443 ssl;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>server_name<span style='mso-spacerun:yes'>&nbsp; </span>localhost;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>ssl_certificate<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/etc/nginx/conf.d/allinpay.crt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'><span style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;
</span>ssl_certificate_key<span style='mso-spacerun:yes'>&nbsp; </span>/etc/nginx/conf.d/allinpay.key;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l18 level1 lfo19'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>更多设置</p>

<div style='mso-element:para-border-div;border:solid #D1D7DC 1.0pt;mso-border-alt:
solid #D1D7DC .75pt;padding:2.0pt 0cm 2.0pt 8.0pt;background:#FAFAFA;
margin-left:10.5pt;margin-right:0cm'>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>#</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>为一个</span><span lang=EN-US
style='font-size:9.0pt;font-family:Consolas;color:black'>server</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>开启</span><span lang=EN-US
style='font-size:9.0pt;font-family:Consolas;color:black'>ssl</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>支持</span><span lang=EN-US
style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;ssl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;#</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>为虚拟主机指定</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>pem</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>格式的证书文件</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;ssl_certificate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/home/wangzhengyi/ssl/wangzhengyi.crt;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>5.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;#</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>为虚拟主机指定私钥文件</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>6.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;ssl_certificate_key&nbsp;&nbsp;/home/wangzhengyi/ssl/wangzhengyi_nopass.key;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>7.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;#</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>客户端能够重复使用存储在缓存中的会话参数时间</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>8.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;ssl_session_timeout&nbsp;&nbsp;5m;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>9.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;#</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>指定使用的</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>ssl</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>协议</span><span lang=EN-US
style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>10.<span style='font:7.0pt "Times New Roman"'> </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;ssl_protocols&nbsp;&nbsp;SSLv3&nbsp;TLSv1;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>11.<span style='font:7.0pt "Times New Roman"'> </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;#</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>指定许可的密码描述</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>12.<span style='font:7.0pt "Times New Roman"'> </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;ssl_ciphers&nbsp;&nbsp;ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>13.<span style='font:7.0pt "Times New Roman"'> </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;#SSLv3</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>和</span><span lang=EN-US
style='font-size:9.0pt;font-family:Consolas;color:black'>TLSv1</span><span
style='font-size:9.0pt;mso-ascii-font-family:Consolas;mso-hansi-font-family:
Consolas;mso-bidi-font-family:Consolas;color:black'>协议的服务器密码需求优先级高于客户端密码</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt;text-indent:-18.0pt;line-height:
13.5pt;mso-list:l14 level1 lfo2;tab-stops:list 36.0pt;background:#FAFAFA;
border:none;mso-border-alt:solid #D1D7DC .75pt;padding:0cm;mso-padding-alt:
2.0pt 0cm 2.0pt 8.0pt'><![if !supportLists]><span lang=EN-US style='font-size:
9.0pt;font-family:Consolas;mso-fareast-font-family:Consolas;color:#2B91AF'><span
style='mso-list:Ignore'>14.<span style='font:7.0pt "Times New Roman"'> </span></span></span><![endif]><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:black'>&nbsp;&nbsp;&nbsp;&nbsp;ssl_prefer_server_ciphers&nbsp;&nbsp;&nbsp;on;&nbsp;&nbsp;&nbsp;</span><span
lang=EN-US style='font-size:9.0pt;font-family:Consolas;color:#2B91AF'><o:p></o:p></span></p>

</div>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>4.16.2<span
style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US>http</span>和<span lang=EN-US>https</span>合一配置</h3>

<p class=MsoNormal><span lang=EN-US>http</span>和<span lang=EN-US>https</span>可以放在一起，监听的时候指定那个是<span
lang=EN-US>ssl</span>就可以了，配置如下。</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_38"
 o:spid="_x0000_i1059" type="#_x0000_t75" style='width:415.5pt;height:108pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image033.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>配置效果<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_39"
 o:spid="_x0000_i1058" type="#_x0000_t75" style='width:279.75pt;height:68.25pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image034.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考资料</p>

<p class=MsoNormal><span lang=EN-US><a
href="http://nginx.org/cn/docs/http/configuring_https_servers.html">http://nginx.org/cn/docs/http/configuring_https_servers.html</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.cnblogs.com/tintin1926/archive/2012/07/12/2587311.html">http://www.cnblogs.com/tintin1926/archive/2012/07/12/2587311.html</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h1><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]>高级篇</h1>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>编译源代码</span></h2>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.1.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span></span>在<span
lang=EN-US>windwos</span>下的编译<span lang=EN-US>Nginx</span></h3>

<p style='margin:0cm;margin-bottom:.0001pt'><span lang=EN-US style='font-size:
9.0pt;font-family:"Verdana","sans-serif";color:#555555'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span></span>在<span
lang=EN-US>windows</span>下编译<span lang=EN-US>nginx</span>可以利用<span lang=EN-US>VC</span>编译来调试<span
lang=EN-US>nginx</span>，当我们很熟悉了操作系统上层的实现之后转向分析<span lang=EN-US>nginx</span>代码也方便一些。</p>

<p class=MsoNormal>在<span lang=EN-US>windows</span>下编译<span lang=EN-US>nginx</span>跟在<span
lang=EN-US>Linux</span>下的步骤差不多。利用<span lang=EN-US>svn</span>工具下载源码，第三方网站下载的<span
lang=EN-US>tar</span>文件中没有<span lang=EN-US>win32</span>的配置文件；由于<span
lang=EN-US>configure</span>文件是<span lang=EN-US>sh</span>脚本，所以只能用第三方仿真软件，我这里用的是<span
lang=EN-US>MinGW Shell</span>；配置完成后就是编译，只要调用<span lang=EN-US>VC</span>的编译工具<span
lang=EN-US>cl.exe</span>编译就行了。</p>

<p class=MsoNormal>下载工具</p>

<p class=MsoNormal>需要的工具有：</p>

<p class=MsoNormal><span lang=EN-US>1.TortoiseSVN:<a
href="http://downloads.sourceforge.net/project/tortoisesvn/1.7.5/Application/TortoiseSVN-1.7.5.22551-win32-svn-1.7.3.msi"><span
style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>http://downloads.sourceforge.net/project/tortoisesvn/1.7.5/Application/TortoiseSVN-1.7.5.22551-win32-svn-1.7.3.msi</span></a></span></p>

<p class=MsoNormal><span lang=EN-US>2.MinGW32:<a
href="http://10.10.4.6/download/7377061/8602355/3/exe/230/40/1322227850470_40/mingw-get-inst-20111118.exe"><span
style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>http://10.10.4.6/download/7377061/8602355/3/exe/230/40/1322227850470_40/mingw-get-inst-20111118.exe</span></a></span></p>

<p class=MsoNormal><span lang=EN-US>3.VC2010 express:<a
href="http://download.microsoft.com/download/e/5/e/e5e362e1-6a2a-4ce3-bbac-659c9740ab04/vc_web.exe"><span
style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>http://download.microsoft.com/download/e/5/e/e5e362e1-6a2a-4ce3-bbac-659c9740ab04/vc_web.exe</span></a></span></p>

<p class=MsoNormal>上面的工具下载安装完成即可。</p>

<p class=MsoNormal>下载源码</p>

<p class=MsoNormal>源码地址在：<span lang=EN-US>svn://svn.nginx.org/nginx/trunk </span>使用<span
lang=EN-US>svn</span>将源码检出到本地任意目录，比如<span lang=EN-US>f:\nginx\trunk</span></p>

<p class=MsoNormal>目录结构如下： </p>

<p class=MsoNormal>配置代码环境</p>

<p class=MsoNormal>打开<span lang=EN-US>cmd</span>命令行提示<span lang=EN-US>:</span></p>

<p class=MsoNormal><span lang=EN-US>cmd</span></p>

<p class=MsoNormal><span lang=EN-US>2.</span>设置<span lang=EN-US>VC</span>的环境变量：在命令提示符中键入命令（根据<span
lang=EN-US>VC</span>的安装目录不同而不同<span lang=EN-US>,x86</span>为参数）</p>

<p class=MsoNormal><span lang=EN-US>&quot;C:\Program Files\Microsoft Visual
Studio 10.0\VC\vcvarsall.bat&quot; x86</span></p>

<p class=MsoNormal>设置<span lang=EN-US>MinGW</span>：在命令提示符键入命令（根据<span
lang=EN-US>MinGW32</span>安装目录不同而不同）：</p>

<p class=MsoNormal><span lang=EN-US>C:\MinGW\msys\1.0\msys.bat</span></p>

<p class=MsoNormal>检查环境：</p>

<p class=MsoNormal>弹出<span lang=EN-US>MinGW</span>窗口，关闭其它的<span lang=EN-US>cmd</span>窗口。在<span
lang=EN-US>MinGW32</span>的窗口输入<span lang=EN-US>:</span></p>

<p class=MsoNormal><span lang=EN-US>cl.exe</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal><span lang=EN-US>cd /f/nginx/trunk</span></p>

<p class=MsoNormal>配置<span lang=EN-US>:</span></p>

<p class=MsoNormal><span lang=EN-US>./auto/configure --prefix=.
--with-cc-opt=&quot;-D FD_SETSIZE=4096&quot; --without-http_rewrite_module
--without-http_gzip_module --with-cc=cl</span></p>

<p class=MsoNormal>注解：</p>

<p class=MsoNormal><span lang=EN-US>–prefix=. </span>表示安装目录在本目录下</p>

<p class=MsoNormal><span lang=EN-US>–with-cc-opt=”-D FD_SETSIZE=4096″ </span>预定义宏<span
lang=EN-US>FD_SETSIZE</span>大小<span lang=EN-US>4096</span></p>

<p class=MsoNormal><span lang=EN-US>–without-http_rewrite_module </span>不加载<span
lang=EN-US>rewite</span>模块</p>

<p class=MsoNormal><span lang=EN-US>–without-http_gzip_module </span>不加载<span
lang=EN-US>gzip</span>模块</p>

<p class=MsoNormal><span lang=EN-US>–with-cc=cl </span>编译器为<span lang=EN-US>cl</span></p>

<p class=MsoNormal>编译<span lang=EN-US>:</span></p>

<p class=MsoNormal><span lang=EN-US>nmake</span></p>

<p class=MsoNormal>在<span lang=EN-US>obj/</span>目录下为生成的中间文件和<span lang=EN-US>nginx.exe</span>文件。</p>

<p style='margin:0cm;margin-bottom:.0001pt'><span lang=EN-US style='font-size:
10.5pt;font-family:"Calibri","sans-serif";mso-bidi-font-family:宋体'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span class=1Char><span lang=EN-US style='font-size:
22.0pt;line-height:173%'><span style='mso-list:Ignore'>5.1.2<span
style='font:7.0pt "Times New Roman"'> </span></span></span></span><![endif]><span
class=1Char><span style='font-size:22.0pt;line-height:173%'>在<span lang=EN-US>linux</span>下编译版本<span
lang=EN-US><o:p></o:p></span></span></span></h3>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.1.2.1<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>下载</span></h4>

<p class=MsoNormal><span lang=EN-US>wget <a
href="http://nginx.org/download/nginx-1.7.1.tar.gz">http://nginx.org/download/nginx-1.7.1.tar.gz</a>
</span></p>

<p class=MsoNormal><span lang=EN-US>tar -xvzf<span
style='mso-spacerun:yes'>&nbsp; </span>nginx-1.7.1.tar.gz</span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.1.2.2<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span><span style='font-family:宋体;
mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:Cambria;
mso-hansi-theme-font:major-latin'>配置编译选项</span></h4>

<p class=MsoNormal>编译配置</p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>./configure<span style='mso-spacerun:yes'>&nbsp;
</span>--sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf<span
style='mso-spacerun:yes'>&nbsp; </span>--with-pcre=/root/pcre-8.33
--with-zlib=/root/zlib-1.2.8 --with-http_stub_status_module<span
style='mso-spacerun:yes'>&nbsp; </span>--with-http_ssl_module
--add-module=../ngx_cache_purge-2.1<o:p></o:p></span></p>

<p class=MsoNormal>说明：</p>

<p class=MsoNormal><span lang=EN-US>--sbin-path </span>执行文件<span lang=EN-US>nginx</span>的路径</p>

<p class=MsoNormal><span lang=EN-US>--conf-path<span
style='mso-spacerun:yes'>&nbsp; </span></span>配置文件的路径</p>

<p class=MsoNormal><span lang=EN-US>--with-pcre </span>编译依赖<span lang=EN-US>pcre</span>正则表达式库</p>

<p class=MsoNormal><span lang=EN-US>--with-zlib<span
style='mso-spacerun:yes'>&nbsp; </span></span>编译依赖<span lang=EN-US>zlib</span>库</p>

<p class=MsoNormal><span lang=EN-US>--with-xxxx<span
style='mso-spacerun:yes'>&nbsp; </span></span>是开启某个功能特性</p>

<p class=MsoNormal><span lang=EN-US>--add-module </span>是编译插件，插件下载源代码，然后指定目录就可以了。</p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal>更多资料：</p>

<p class=MsoNormal><span lang=EN-US><a
href="http://nginx.org/en/docs/configure.html">http://nginx.org/en/docs/configure.html</a><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span>编译选项</p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.1.2.3<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>下载相关依赖包</span></h4>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l19 level1 lfo3'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>PCRE - Perl Compatible Regular
Expressions</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;
</span><a href="http://www.pcre.org/">http://www.pcre.org/</a></span></p>

<p class=MsoNormal style='margin-left:6.0pt;mso-para-margin-left:.5gd;
text-indent:6.0pt;mso-char-indent-count:.5'><span lang=EN-US>linux</span>下安装安装<span
lang=EN-US>pcre-8.32 </span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l19 level1 lfo3'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>zlib</span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.1.2.4<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>编译安装</span></h4>

<p class=MsoNormal><span lang=EN-US>make &amp; make install</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.1.2.5<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span><span style='font-family:宋体;
mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:Cambria;
mso-hansi-theme-font:major-latin'>插件安装</span></h4>

<p class=MsoNormal><span lang=EN-US><a
href="http://labs.frickle.com/files/ngx_cache_purge-2.1.tar.gz">http://labs.frickle.com/files/ngx_cache_purge-2.1.tar.gz</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.1.2.6<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>编译常见错误</span></h4>

<p class=MsoNormal style='margin-left:6.0pt;text-indent:-6.0pt;mso-char-indent-count:
-.5'><span lang=EN-US>configure: error: You need a C++ compiler for C++ support</span></p>

<p class=MsoNormal>说明已经安装<span lang=EN-US> gcc,</span>需要安装<span lang=EN-US>
gcc-c++,</span>执行命令<span lang=EN-US>yum install gcc-c++ </span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>Nginx Linux</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>服务</span></h2>

<p class=MsoNormal><span lang=EN-US style='color:black'><span
style='mso-spacerun:yes'>&nbsp;</span><o:p></o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.2.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>linux </span>把<span lang=EN-US>nginx</span>加入到系统服务，并开机自己启动的方法</h3>

<p class=MsoNormal><span lang=EN-US>yum install nginx</span>有这个脚本，也是直接使用。</p>

<p class=MsoNormal><span lang=EN-US>/etc/rc.d/init.d/nginx</span></p>

<p style='mso-line-height-alt:2.0pt'><span style='font-size:7.5pt;font-family:
"微软雅黑","sans-serif";color:black;background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>一。首先写一个<span lang=EN-US>shell</span>脚本，脚本名称：<span
lang=EN-US>nginx<o:p></o:p></span></span></p>

<p class=MsoNormal><span style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
color:black;background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>参考<span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span></span><span
lang=EN-US>/etc/rc.d/init.d/nginx</span><span lang=EN-US style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";color:black;background:#D9D9D9;mso-shading:
white;mso-pattern:gray-15 auto'><o:p></o:p></span></p>

<p><span style='color:black'>二。将<span lang=EN-US>shell</span>脚本放入到<span
lang=EN-US> /etc/rc.d/init.d/ </span>目录下，并执行下列命令<span lang=EN-US><o:p></o:p></span></span></p>

<p><span lang=EN-US style='color:black'>1</span><span style='color:black'>：<span
lang=EN-US>chmod +x /etc/rc.d/init.d/nginx </span>（设置可执行权限）<span lang=EN-US><o:p></o:p></span></span></p>

<p><span lang=EN-US style='color:black'>2</span><span style='color:black'>：<span
lang=EN-US>chkconfig --add nginx </span>（添加系统服务）<span lang=EN-US><o:p></o:p></span></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.2.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>Nginx Windows</span>服务</h3>

<p class=MsoNormal style='line-height:15.0pt;background:white'><strong><span
lang=EN-US style='font-size:9.0pt;font-family:"Arial","sans-serif";color:#666666'>1.
</span></strong><strong><span style='font-size:9.0pt;font-family:宋体;mso-ascii-font-family:
Arial;mso-hansi-font-family:Arial;mso-bidi-font-family:Arial;color:#666666'>下载微软的</span></strong><strong><span
lang=EN-US style='font-size:9.0pt;font-family:"Arial","sans-serif";color:#666666'>2</span></strong><strong><span
style='font-size:9.0pt;font-family:宋体;mso-ascii-font-family:Arial;mso-hansi-font-family:
Arial;mso-bidi-font-family:Arial;color:#666666'>个工具</span></strong><strong><span
lang=EN-US style='font-size:9.0pt;font-family:"Arial","sans-serif";color:#666666'>:
instsrv.exe</span></strong><strong><span style='font-size:9.0pt;font-family:
宋体;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;mso-bidi-font-family:
Arial;color:#666666'>、</span></strong><strong><span lang=EN-US
style='font-size:9.0pt;font-family:"Arial","sans-serif";color:#666666'>srvany.exe</span></strong><span
lang=EN-US style='font-size:9.0pt;font-family:"Arial","sans-serif";color:#666666'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
style='font-size:9.0pt;mso-ascii-font-family:Arial;mso-hansi-font-family:Arial;
mso-bidi-font-family:Arial'>去微软网站下载安装</span><span lang=EN-US style='font-size:
9.0pt;font-family:"Arial","sans-serif"'>Windows Server 2003 Resource Kit
Tools(rktools.exe)</span><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial","sans-serif"'><o:p></o:p></span></p>

<p style='margin-top:0cm;margin-right:0cm;margin-bottom:7.5pt;margin-left:0cm;
background:white'><strong><span lang=EN-US style='font-size:9.0pt;font-family:
"Arial","sans-serif";color:#666666'>2. </span></strong><strong><span
style='font-size:9.0pt;font-family:宋体;mso-ascii-font-family:Arial;mso-hansi-font-family:
Arial;mso-bidi-font-family:Arial;color:#666666'>运行命令</span></strong><span
lang=EN-US style='font-size:9.0pt;font-family:"Arial","sans-serif";color:#666666'>&nbsp;</span><span
lang=EN-US style='font-size:11.5pt;font-family:"Arial","sans-serif";color:#625B49'><o:p></o:p></span></p>

<p style='margin-top:0cm;margin-right:0cm;margin-bottom:7.5pt;margin-left:0cm;
background:white'><span style='font-size:10.5pt;mso-ascii-font-family:宋体;
mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial'>在<span lang=EN-US>rktools</span>安装目录下<span
lang=EN-US>(</span>一般在<span lang=EN-US>C:\Program Files\Windows Resource Kits\Tools</span>目录<span
lang=EN-US>)</span>可以发现这两个程序<span lang=EN-US>.</span>在运行下面命令之前，确保将<span
lang=EN-US>srvany.exe</span>复制到<span lang=EN-US>nginx</span>的安装<span
lang=EN-US>(</span>解压<span lang=EN-US>)</span>目录下，然后运行<span lang=EN-US>:&nbsp; <o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>Command</span><span style='font-size:10.5pt;mso-ascii-font-family:宋体;
mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial'>代码<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>instsrv&nbsp;Nginx&nbsp;D:\nginx\srvany.exe<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:Arial'>这样就安装了一个名为<span
lang=EN-US>Nginx</span>的服务。也就是将<span lang=EN-US>srvany.exe</span>注册成一个服务<span
lang=EN-US>Nginx</span>。<span lang=EN-US>Net start&nbsp;Nginx</span>时，肯定会运行<span
lang=EN-US>srvany.exe</span>。<span lang=EN-US>&nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><strong><span
lang=EN-US style='font-size:10.5pt;font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-theme-font:minor-fareast;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial;color:#625B49'>3. </span></strong><strong><span
style='font-size:10.5pt;font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-theme-font:minor-fareast;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial;color:#625B49'>配置<span lang=EN-US>Nginx</span>的运行参数：目的是运行<span
lang=EN-US>srvany.exe</span>时，附带运行<span lang=EN-US>D:\nginx\nginx.exe</span>程序。</span></strong><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial;color:#625B49'>&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:Arial'>可以直接将配置导入到注册表<span
lang=EN-US>&nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>Window register</span><span style='font-size:10.5pt;mso-ascii-font-family:
宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial'>代码<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>Windows Registry Editor Version&nbsp;5.00&nbsp;&nbsp;<o:p></o:p></span></p>

<p style='margin-top:0cm;margin-right:0cm;margin-bottom:7.5pt;margin-left:0cm;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;mso-bidi-font-family:Arial'>?[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NGINX\Parameters]
&nbsp;&nbsp;<o:p></o:p></span></p>

<p style='margin-top:0cm;margin-right:0cm;margin-bottom:7.5pt;margin-left:0cm;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;mso-bidi-font-family:Arial'>&quot;Application&quot;=&quot;e:\……\nginx\nginx.exe&quot;&nbsp;
<o:p></o:p></span></p>

<p style='margin-top:0cm;margin-right:0cm;margin-bottom:7.5pt;margin-left:0cm;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:
宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:
minor-fareast;mso-bidi-font-family:Arial'>&quot;AppParameters&quot;=&quot;&quot;&nbsp;&nbsp;
<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>&quot;AppDirectory&quot;=&quot;e:\……\nginx\&quot;&nbsp;&nbsp;<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:Arial'>现在就可以通过控制面板<span
lang=EN-US>-&gt;</span>管理员工具<span lang=EN-US>-&gt;</span>服务中找到该服务，并启动和停止了。<span
lang=EN-US>&nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:Arial'>但是，当停止<span
lang=EN-US>Nginix</span>服务后，访问浏览器仍然能看到网站。查看进程，你会发现，<span lang=EN-US>Nginx</span>启动了两个<span
lang=EN-US>nginx</span>进程<span lang=EN-US>(</span>根据<span lang=EN-US>nginx.conf</span>的配置<span
lang=EN-US>worker_processes 1;)</span>，<span lang=EN-US>Fork</span>出来的进程显然没有被停止，结果就是<span
lang=EN-US>nginx</span>永远关不掉。因此彻底关闭<span lang=EN-US>nginx</span>请使用<span
lang=EN-US>taskkill</span>命令<span lang=EN-US>:&nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>Command</span><span style='font-size:10.5pt;mso-ascii-font-family:宋体;
mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial'>代码<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>taskkill /F /IM&nbsp;nginx.exe &gt; nul<o:p></o:p></span></p>

<p class=MsoNormal style='line-height:15.0pt;background:white'><span
style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:minor-fareast;
mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;mso-hansi-font-family:
宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:Arial'>结果是写一个<span
lang=EN-US>stop_nginx</span>脚本来处理<span lang=EN-US>nginx</span>停止的所有操作<span
lang=EN-US>&nbsp;<o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>Command</span><span style='font-size:10.5pt;mso-ascii-font-family:宋体;
mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial'>代码<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>@echo off&nbsp;&nbsp;<span class=apple-converted-space>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>echo Stopping nginx service...<span class=apple-converted-space>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>net stop nginx&nbsp;&nbsp;<span class=apple-converted-space>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>echo Kill nginx process...&nbsp;&nbsp;<span class=apple-converted-space>&nbsp;</span><o:p></o:p></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'>taskkill /F /IM nginx.exe<o:p></o:p></span></p>

<p class=MsoNormal style='background:white;word-break:break-all'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.5pt;mso-ascii-font-family:
宋体;mso-ascii-theme-font:minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:
minor-fareast;mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;
mso-bidi-font-family:Arial'>参考<span lang=EN-US><o:p></o:p></span></span></b></p>

<p class=MsoNormal><span lang=EN-US><a href="http://blog.slogra.com/?post=2">http://blog.slogra.com/?post=2</a></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://bluexp29.blog.163.com/blog/static/33858148201152275447553/">http://bluexp29.blog.163.com/blog/static/33858148201152275447553/</a></span><span
lang=EN-US style='font-size:10.5pt;mso-ascii-font-family:宋体;mso-ascii-theme-font:
minor-fareast;mso-fareast-font-family:宋体;mso-fareast-theme-font:minor-fareast;
mso-hansi-font-family:宋体;mso-hansi-theme-font:minor-fareast;mso-bidi-font-family:
Arial'><o:p></o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.3<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>修改</span><span
lang=EN-US>nginx</span><span style='font-family:宋体;mso-ascii-font-family:Cambria;
mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>服务标识</span></h2>

<p class=MsoNormal>首先修改源文件，然后重新编译一下。</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>vi src/core/nginx.h</span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span><span style='mso-no-proof:yes'><v:shape
 id="图片_x0020_58" o:spid="_x0000_i1057" type="#_x0000_t75" style='width:331.5pt;
 height:205.5pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image035.png" o:title=""/>
</v:shape></span></span></p>

<p class=MsoNormal>效果如下图</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_60"
 o:spid="_x0000_i1056" type="#_x0000_t75" style='width:276.75pt;height:96.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image036.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.4<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>Nginx</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>优化</span></h2>

<p class=MsoNormal><span lang=EN-US>nginx</span>优化主要包括两个方面，一个是自身的优化，另一个是运行环境优化。</p>

<p class=MsoNormal>自身的优化包括支持高并发，高可靠，高性能，一般从支持连接数，集群，更好的网络模型，缓存等着手考虑，<span
lang=EN-US>nginx</span>应用场景不同，所以还要更具具体的应用场景做配置上的调整。另一个是<span lang=EN-US>nginx</span>运行环境的优化，包括<span
lang=EN-US>nginx</span>运行的软硬件环境，硬件环境取决于服务类型选择和投入情况，软件优化只是从操作系统级别进行调整。</p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.4.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span>cpu</span>调整</h3>

<p class=MsoNormal><span lang=EN-US>nginx</span>多进程多线程模式，每个<span lang=EN-US>worker</span>占用一个进程。</p>

<p class=MsoNormal><span lang=EN-US>nginx</span>使用的时候要指定工作的进程数，默认为<span
lang=EN-US>1. </span></p>

<p class=MsoNormal>这个数目一般和处理器的数据</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>官方给出的建议：</p>

<p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>一般一个进程足够了，你可以把连接数设得很大。如果有<span lang=EN-US>SSL</span>、</span><span
lang=EN-US><a href="http://www.ha97.com/tag/gzip" title=gzip><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>gzip</span></a></span><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>这些比较消耗<span
lang=EN-US>CPU</span>的工作，而且是多核<span lang=EN-US>CPU</span>的话，可以设为和<span
lang=EN-US>CPU</span>的数量一样。或 者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用<span
lang=EN-US>IO</span>带宽（主要似乎是<span lang=EN-US>IO</span>操作有<span lang=EN-US>block</span>）。
<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>我们知道不管是多进程还是单一进程主要的目的是尽可能的压榨<span lang=EN-US>cpu</span>。</p>

<p class=MsoNormal>一个进程的最大连接数是<span lang=EN-US>65535</span>个，如果想突破这个连接数就必须增加进程数。高并发的情况下，需要提供进程数目。</p>

<p class=MsoNormal>多核多进程要比多核多线程更稳定，所以多核环境下尽可能配置成多进程。 </p>

<p class=MsoNormal>配置成多进程唯一要考虑的是多进程切换问题所带来的开销。</p>

<p class=MsoNormal>高并发的时候配置成：和<span lang=EN-US>cpu</span>一样的数量。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.4.1.1<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>全局环境下配置工作线程</span></h4>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>通过下面的命令查看<span lang=EN-US>cpu</span>信息</p>

<p class=MsoNormal><span lang=EN-US>cat /proc/cpuinfo | grep processor</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>如果<span lang=EN-US>cpu</span>有四个核心<span
lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>worker_processes 4;</span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>worker_cpu_affinity 0001 0010 0100 1000; </span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>如果<span lang=EN-US>cpu</span>有八个核心
<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>worker_processes 8;</span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000
00100000 01000000 10000000;</span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>如果<span lang=EN-US>cpu</span>有十六个核心
<span lang=EN-US><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>worker_processes 16;</span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
lang=EN-US>worker_cpu_affinity 0000000000000001 0000000000000010
0000000000000100 0000000000001000 0000000000010000 0000000000100000
0000000001000000 0000000010000000 0000000100000000 0000001000000000
0000010000000000 0000100000000000 0001000000000000 0010000000000000
0100000000000000 1000000000000000; </span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.4.1.2<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US>Windows</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>多核稳定性测试</span></h4>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l4 level1 lfo10'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1．</span></span><![endif]>测试环境</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="_x0000_i1055"
 type="#_x0000_t75" style='width:415.5pt;height:96.75pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image037.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>Window7 </span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_7"
 o:spid="_x0000_i1054" type="#_x0000_t75" style='width:261.75pt;height:73.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image038.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="_x0000_i1053"
 type="#_x0000_t75" style='width:294pt;height:84pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image039.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l4 level1 lfo10'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2．</span></span><![endif]>一个工作进程</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_10"
 o:spid="_x0000_i1052" type="#_x0000_t75" style='width:414.75pt;height:171pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image040.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US>Cpu</span>，<span lang=EN-US>windows</span>系统自动分配。
全部可以用</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_13"
 o:spid="_x0000_i1051" type="#_x0000_t75" style='width:415.5pt;height:3in;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image041.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_16"
 o:spid="_x0000_i1050" type="#_x0000_t75" style='width:415.5pt;height:375pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image042.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>结论：相当快，比较稳定。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>四核</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_22"
 o:spid="_x0000_i1049" type="#_x0000_t75" style='width:313.5pt;height:79.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image043.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_19"
 o:spid="_x0000_i1048" type="#_x0000_t75" style='width:415.5pt;height:246pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image044.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_31"
 o:spid="_x0000_i1047" type="#_x0000_t75" style='width:415.5pt;height:180pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image045.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal>结论<span lang=EN-US>:</span>直接不工作</p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal>配置<span lang=EN-US> 8</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_25"
 o:spid="_x0000_i1046" type="#_x0000_t75" style='width:415.5pt;height:213.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image046.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>工作，但是很不稳定 </p>

<p class=MsoNormal>结论：在其他配置，不可用。<span lang=EN-US> windows</span>系统上非常不稳定。 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.4.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span></span>最大连接数</h3>

<p class=MsoNormal><span lang=EN-US>worker_connections</span>是最大连接数，但是这个连接说是对一个<span
lang=EN-US>worker</span>进程来说的，所以<span lang=EN-US style='font-size:10.5pt;
font-family:"Tahoma","sans-serif";color:#454545'>&nbsp;</span><strong><span
style='font-size:10.5pt;font-family:宋体;mso-ascii-font-family:Tahoma;mso-hansi-font-family:
Tahoma;mso-bidi-font-family:Tahoma;color:#454545'>最大连接数</span></strong><strong><span
lang=EN-US style='font-size:10.5pt;font-family:"Tahoma","sans-serif";
color:#454545'> = worker_processes * worker_connections </span></strong></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span><span style='mso-no-proof:yes'><v:shape
 id="图片_x0020_72" o:spid="_x0000_i1045" type="#_x0000_t75" style='width:257.25pt;
 height:126.75pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image047.png" o:title=""/>
</v:shape></span></span></p>

<p class=MsoNormal>注意<span lang=EN-US>worker_connection</span>依赖<span
lang=EN-US>worker_rlimit_nofile <span style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p class=MsoNormal><strong><span lang=EN-US style='font-family:宋体;mso-bidi-font-family:
宋体'>worker_rlimit_nofile</span></strong><strong><span style='font-family:宋体;
mso-bidi-font-family:宋体'>是<span lang=EN-US>worker</span>工作进程资源限制中文件的数目，代表了</span></strong><span
lang=EN-US>worker</span>进程的最大打开文件数限制，如果没有设置<span lang=EN-US>nginx</span>高并发的时候会有<span
lang=EN-US>“too many open files”</span>问题了。</p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_70"
 o:spid="_x0000_i1044" type="#_x0000_t75" style='width:415.5pt;height:73.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image048.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal>这个值受操作系统的限制，需要修改用户的打开文件限制</p>

<p class=MsoNormal>执行命令 <span lang=EN-US>ulimit –SHn 65535</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_71"
 o:spid="_x0000_i1043" type="#_x0000_t75" style='width:259.5pt;height:129pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image049.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.4.3<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span></span>网络工作模式</h3>

<p class=MsoNormal><span lang=EN-US>nginx</span>会自动选择，这个可以不用配置。<code><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p></o:p></span></code></p>

<p class=MsoNormal><span lang=EN-US>events {</span></p>

<p class=MsoNormal><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp;&nbsp;
</span>use epoll;</span></p>

<p class=MsoNormal><span lang=EN-US>…</span></p>

<p class=MsoNormal><span lang=EN-US>}<span style='display:none;mso-hide:all'><o:p></o:p></span></span></p>

<p class=MsoNormal><b><span lang=EN-US>use</span></b>设置用于复用客户端线程的轮询方法。如果你使用<span
lang=EN-US>Linux 2.6+</span>，你应该使用<span lang=EN-US>epoll</span>。如果你使用<span
lang=EN-US>*BSD</span>，你应该使用<span lang=EN-US>kqueue</span>。 </p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.4.4<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>压力测试</h3>

<p class=MsoNormal><span lang=EN-US>2000</span>个并发<span lang=EN-US> cpu</span>使用率<span
lang=EN-US>17%</span></p>

<p class=MsoNormal><span lang=EN-US>3000</span>个并发<span lang=EN-US> cpu</span>使用率<span
lang=EN-US>20%</span></p>

<p class=MsoNormal>所以<span lang=EN-US>nginx</span>对<span lang=EN-US>cpu</span>的占用率非常低，内存增加<span
lang=EN-US>100MB,</span>性能瓶颈主要在网络<span lang=EN-US>IO</span>。</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>下面是<span lang=EN-US>2000</span>并发压力和<span lang=EN-US>3000</span>并发压力的测试</p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.4.4.1<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>2000</span><span style='font-family:宋体;
mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:Cambria;
mso-hansi-theme-font:major-latin'>个压力</span></h4>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_76"
 o:spid="_x0000_i1042" type="#_x0000_t75" style='width:336.75pt;height:199.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image050.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_77"
 o:spid="_x0000_i1041" type="#_x0000_t75" style='width:415.5pt;height:110.25pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image051.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_78"
 o:spid="_x0000_i1040" type="#_x0000_t75" style='width:415.5pt;height:132.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image052.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_79"
 o:spid="_x0000_i1039" type="#_x0000_t75" style='width:415.5pt;height:141.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image053.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h4><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.4.4.2<span style='font:7.0pt "Times New Roman"'>
</span></span></span><![endif]><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span>3000</span><span style='font-family:宋体;
mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:
宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:Cambria;
mso-hansi-theme-font:major-latin'>个并发压力</span></h4>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_80"
 o:spid="_x0000_i1038" type="#_x0000_t75" style='width:296.25pt;height:180pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image054.png" o:title=""/>
</v:shape><span style='mso-spacerun:yes'>&nbsp;</span><v:shape id="图片_x0020_82"
 o:spid="_x0000_i1037" type="#_x0000_t75" style='width:415.5pt;height:123.75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image055.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_81"
 o:spid="_x0000_i1036" type="#_x0000_t75" style='width:415.5pt;height:123pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image056.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.4.5<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span></span>运行状态查看</h3>

<p class=MsoListParagraph style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;margin-left:18.0pt;text-indent:-18.0pt;mso-char-indent-count:0;mso-list:
l0 level1 lfo22'><![if !supportLists]><span lang=EN-US><span style='mso-list:
Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>通过<span
lang=EN-US>http://localhost/status </span>进行监控</p>

<p class=MsoListParagraph style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;margin-left:18.0pt;text-indent:-18.0pt;mso-char-indent-count:0;mso-list:
l0 level1 lfo22'><![if !supportLists]><span lang=EN-US><span style='mso-list:
Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>查看当前连接状态</p>

<p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>执行命令：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S)
print a, S[a]}'<o:p></o:p></span></p>

<p class=MsoNormal><span style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>显示：<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>TIME_WAIT 17<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>ESTABLISHED 3254<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>LAST_ACK 236<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>FIN_WAIT_1 648<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>FIN_WAIT_2 581<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>CLOSING 7<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>CLOSE_WAIT 4916<o:p></o:p></span></p>

<p class=MsoNormal>状态说明：</p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>CLOSED<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>无连接是活动的或正在进行<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>LISTEN<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>服务器在等待进入呼叫<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>SYN_RECV<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>一个连接请求已经到达，等待确认<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>SYN_SENT<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>应用已经开始，打开一个连接<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>ESTABLISHED<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>正常数据传输状态<span
lang=EN-US>/</span>当前并发连接数<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>FIN_WAIT1<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>应用说它已经完成<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>FIN_WAIT2<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>另一边已同意释放<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>ITMED_WAIT<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>等待所有分组死掉<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>CLOSING<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>两边同时尝试关闭<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>TIME_WAIT<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>另一边已初始化一个释放<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt'>LAST_ACK<span
style='mso-spacerun:yes'>&nbsp; </span>//</span><span style='font-size:9.0pt'>等待所有分组死掉<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l0 level1 lfo22'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>tsar</span>工具提供了对<span
lang=EN-US>nginx</span>监控</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US>Tsar</span>是淘宝开发的一个非常好用的系统监控工具，在淘宝内部大量使用，是对系统命令<span
lang=EN-US>sar</span>的增强它不仅可以监控<span lang=EN-US>CPU</span>、<span lang=EN-US>IO</span>、内存、<span
lang=EN-US>TCP</span>等系统状态，也可以监控<span lang=EN-US>Apache</span>，<span
lang=EN-US>Nginx/Tengine</span>，<span lang=EN-US>Squid</span>等服务器状态，值得一提的是<span
lang=EN-US>Tsar </span>支持将数据存储到<span lang=EN-US> MySQL </span>中，也可以将数据发送到<span
lang=EN-US> Nagios </span>报警服务器</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:30.0pt;text-align:justify;
text-justify:inter-ideograph;text-indent:-18.0pt;mso-char-indent-count:0;
mso-list:l10 level1 lfo23'><![if !supportLists]><span lang=EN-US><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>获取编译</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>$wget
-O tsar.zip </span><span lang=EN-US><a
href="https://github.com/alibaba/tsar/archive/master.zip"><span
style='color:windowtext;background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto;
text-decoration:none;text-underline:none'>&nbsp;https://github.com/alibaba/tsar/archive/master.zip</span></a><span
style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'> <o:p></o:p></span></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>$unzip
tsar.zip <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>$cd
tsar-master <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>$make
<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>$make
install <o:p></o:p></span></p>

<p class=MsoListParagraph style='margin-left:30.0pt;text-align:justify;
text-justify:inter-ideograph;text-indent:-18.0pt;mso-char-indent-count:0;
mso-list:l10 level1 lfo23'><![if !supportLists]><span lang=EN-US><span
style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>编辑配置文件</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US>vi
/etc/tsar/tsar.conf</span>，开启<span lang=EN-US>mod_nginx</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US
style='mso-no-proof:yes'><v:shape id="图片_x0020_35" o:spid="_x0000_i1035"
 type="#_x0000_t75" style='width:148.5pt;height:110.25pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image057.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-align:justify;
text-justify:inter-ideograph;text-indent:-18.0pt;mso-char-indent-count:0;
mso-list:l19 level1 lfo3'><![if !supportLists]><span lang=EN-US><span
style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]>执行命令</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US>tsar –nginx –l<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span>每隔<span lang=EN-US>5</span>秒钟，显示统计数据</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US
style='mso-no-proof:yes'><v:shape id="图片_x0020_36" o:spid="_x0000_i1034"
 type="#_x0000_t75" style='width:415.5pt;height:66.75pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image058.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'>发现所有的结果值都是横线<span lang=EN-US>,</span>是因为<span
lang=EN-US>mod_nginx</span>依赖<span lang=EN-US> nginx</span>的状态模块</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'>需要配置</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>location /nginx_status {</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>stub_status on;</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>access_log<span style='mso-spacerun:yes'>&nbsp;&nbsp; </span>off;</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>allow 127.0.0.1;</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>deny all;</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'>其获取状态页的<span lang=EN-US>url</span>默认是<span
lang=EN-US><a href="http://127.0.0.1/nginx_status">http://127.0.0.1/nginx_status</a></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US>tar_nginx</span>使用的几个环境变量</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>export NGX_TSAR_HOST=127.0.0.1</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>export NGX_TSAR_PORT=80</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>export NGX_TSAR_SERVER_NAME=localhost</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US>export NGX_TSAR_URI=/nginx_status</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'>参考资料：</p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US><a
href="http://www.361way.com/tsar-nginx/2308.html">http://www.361way.com/tsar-nginx/2308.html</a><span
style='mso-spacerun:yes'>&nbsp; </span></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US><a
href="https://github.com/taobao/tsar-mod_nginx">https://github.com/taobao/tsar-mod_nginx</a></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd;
text-align:justify;text-justify:inter-ideograph'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'>配置实用请参考
<span lang=EN-US><a href="http://code.taobao.org/p/tsar/wiki/guide/">http://code.taobao.org/p/tsar/wiki/guide/</a></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'>教程 <span
lang=EN-US>http://code.taobao.org/p/tsar/wiki/index/</span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'>官方网站： <span
lang=EN-US><a href="http://tsar.taobao.org/">http://tsar.taobao.org/</a></span></p>

<p class=MsoNormal style='margin-left:12.0pt;mso-para-margin-left:1.0gd'><span
lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:48.0pt;mso-para-margin-left:4.0gd;
text-indent:0cm;mso-char-indent-count:0'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l0 level1 lfo22'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>4.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>自定义脚本，添加到定时任务中</p>

<p class=MsoListParagraph style='mso-margin-top-alt:auto;mso-margin-bottom-alt:
auto;margin-left:18.0pt;text-indent:0cm;mso-char-indent-count:0'>下面脚本用于监控<span
lang=EN-US>Nginx</span>的连接数，<span lang=EN-US>Nginx</span>所占用内存的总数，以及进程数。</p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>#/bin/bash<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>host=`hostname`<br>
ip=`ifconfig eth0 | grep ‘inet addr’|sed ‘s/.*addr://g’|sed ‘s/B.*//g’`<br>
#</span><span style='font-size:7.5pt;background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>监控<span lang=EN-US>nginx</span>的连接数<span lang=EN-US><br>
http_req=`netstat -nat|grep -i “80″|wc -l `<br>
time_stamp=`date “+%Y/%m/%d %T”`<br>
if [ ${http_req} -ge 300 ];<br>
then<br>
echo “alert ==&gt; ${host}@${ip}: http connection ${http_req} &gt;= 300
@${time_stamp} ”<br>
else<br>
echo “${host}@${ip}: http connection ${http_req} @ ${time_stamp}”<br>
fi<br>
##</span>监控<span lang=EN-US>nginx</span>的进程<span lang=EN-US><br>
nginx_proc=`ps -C nginx –no-header | wc -l `<br>
time_stamp=`date “+%Y/%m/%d %T”`<br>
if [ ${nginx_proc} -ge 100 ]<br>
then<br>
echo “alert ==&gt; ${host}@${ip}: nginx process ${nginx_proc} &gt;= 100
@${time_stamp} ”<br>
else<br>
echo “${host}@${ip}: nginx process ${nginx_proc} @ ${time_stamp}”<br>
fi<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>#</span><span style='font-size:
7.5pt;background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>监控<span
lang=EN-US>nginx</span>所占用的内存总数<span lang=EN-US><br>
nginx_mem=`top -b -n1 | grep nginx |gawk ‘{sum += $6}; END {print
int(sum/1024)}’ `<br>
time_stamp=`date “+%Y/%m/%d %T”`<br>
if [ ${nginx_mem} -ge 500 ]<br>
then<br>
echo “alert ==&gt; ${host}@${ip}: nginx memory usage ${nginx_mem} MB &gt;= 500
@${time_stamp} ”<br>
else<br>
echo “${host}@${ip}: nginx memory ${nginx_mem}MB @ ${time_stamp}”<br>
fi<o:p></o:p></span></span></p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.4.6<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>其他优化建议</h3>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l22 level1 lfo21'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>哪些日志开启，日志开启的级别</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l22 level1 lfo21'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>2.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]>如何缓存静态资源 ，缓存资源会减少大量的连接和带宽。</p>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l22 level1 lfo21'><![if !supportLists]><span
lang=EN-US><span style='mso-list:Ignore'>3.<span style='font:7.0pt "Times New Roman"'>&nbsp;
</span></span></span><![endif]><span lang=EN-US>web</span>服务器的压力是比较小的，重点优化后端。</p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.4.7<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>使用<span
lang=EN-US>google-perfools</span>优化<span lang=EN-US>nginx</span></h3>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>TCMalloc</span><span style='font-size:10.5pt;
background:#F9F9F9'>在内存的分配上效率和速度要比<span lang=EN-US>malloc</span>高得多。但是，<span
lang=EN-US>nginx</span>的内存占用其实是很少的，一个进程占用的内存大概只有<span lang=EN-US>12M</span>左右，所以<span
lang=EN-US>google-perftools</span>对<span lang=EN-US>nginx</span>的优化效果可能不太明显。<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>编译参数</p>

<p class=MsoNormal><span lang=EN-US>--with-google_perftools_module</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>参考：</p>

<p class=MsoNormal><span lang=EN-US>https://google-perftools.googlecode.com</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://book.51cto.com/art/201202/314837.htm">http://book.51cto.com/art/201202/314837.htm</a></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>5.5<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>TEngine</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>特性</span></h2>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span>继承<span
lang=EN-US>Nginx-1.4.7</span>的所有特性，<span lang=EN-US>100%</span>兼容<span
lang=EN-US>Nginx</span>的配置； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/dso_cn.html"><span lang=EN-US><span
lang=EN-US>动态模块加载（DSO</span></span><span lang=EN-US><span lang=EN-US>）</span></span></a></span>支持。加入一个模块不再需要重新编译整个<span
lang=EN-US>Tengine</span>； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span>支持<span
lang=EN-US><a
href="http://tengine.taobao.org/document_cn/ngx_http_spdy_module_cn.html">SPDY
v3<span lang=EN-US><span lang=EN-US>协议</span></span></a></span>，自动检测同一端口的<span
lang=EN-US>SPDY</span>请求和<span lang=EN-US>HTTP</span>请求； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/http_core_cn.html"><span
lang=EN-US><span lang=EN-US>流式上传</span></span></a></span>到<span lang=EN-US>HTTP</span>后端服务器或<span
lang=EN-US>FastCGI</span>服务器，大量减少机器的<span lang=EN-US>I/O</span>压力； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span>更加强大的负载均衡能力，包括<span
lang=EN-US><a
href="http://tengine.taobao.org/document_cn/http_upstream_consistent_hash_cn.html"><span
lang=EN-US><span lang=EN-US>一致性hash</span></span><span lang=EN-US><span
lang=EN-US>模块</span></span></a></span>、<span lang=EN-US><a
href="http://tengine.taobao.org/document_cn/http_upstream_session_sticky_cn.html"><span
lang=EN-US><span lang=EN-US>会话保持模块</span></span></a></span>，<span lang=EN-US><a
href="http://tengine.taobao.org/document_cn/http_upstream_check_cn.html"><span
lang=EN-US><span lang=EN-US>还可以对后端的服务器进行主动健康检查</span></span></a></span>，根据服务器状态自动上线下线；
</p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://blog.zhuzhaoyuan.com/2012/01/a-mechanism-to-help-write-web-application-firewalls-for-nginx/"><span
lang=EN-US><span lang=EN-US>输入过滤器机制</span></span></a></span>支持。通过使用这种机制<span
lang=EN-US>Web</span>应用防火墙的编写更为方便； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span>支持设置<span
lang=EN-US>proxy</span>、<span lang=EN-US>memcached</span>、<span lang=EN-US>fastcgi</span>、<span
lang=EN-US>scgi</span>、<span lang=EN-US>uwsgi<a
href="http://tengine.taobao.org/document_cn/ngx_limit_upstream_tries_cn.html"><span
lang=EN-US><span lang=EN-US>在后端失败时的重试次数</span></span></a> </span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://wiki.nginx.org/HttpLuaModule"><span lang=EN-US><span lang=EN-US>动态脚本语言Lua</span></span></a></span>支持。扩展功能非常高效简单；
</p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/http_log_cn.html"><span lang=EN-US><span
lang=EN-US>支持管道（pipe</span></span><span lang=EN-US><span lang=EN-US>）和syslog</span></span><span
lang=EN-US><span lang=EN-US>（本地和远端）形式的日志以及日志抽样</span></span></a></span>； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span>支持按指定关键字<span
lang=EN-US>(</span>域名，<span lang=EN-US>url</span>等<span lang=EN-US>)<a
href="http://tengine.taobao.org/document_cn/http_reqstat_cn.html"><span
lang=EN-US><span lang=EN-US>收集Tengine</span></span><span lang=EN-US><span
lang=EN-US>运行状态</span></span></a></span>； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/http_concat_cn.html"><span
lang=EN-US><span lang=EN-US>组合<span lang=EN-US>多个CSS</span></span></span><span
lang=EN-US><span lang=EN-US>、JavaScript</span></span><span lang=EN-US><span
lang=EN-US>文件的访问请求变成一个请求</span></span></a></span>； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/http_trim_filter_cn.html"><span
lang=EN-US><span lang=EN-US>自动去除空白字符和注释</span></span></a></span>从而减小页面的体积 </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span>自动根据<span
lang=EN-US>CPU</span>数目设置进程个数和绑定<span lang=EN-US>CPU</span>亲缘性； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/http_sysguard_cn.html"><span
lang=EN-US><span lang=EN-US>监控系统的负载和资源占用从而对<span lang=EN-US>系统进行保护</span></span></span></a></span>；
</p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/http_footer_filter_cn.html"><span
lang=EN-US><span lang=EN-US>显示对运维人员更友好的出错信息，便于定位出错机器；</span></span></a> </span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/http_limit_req_cn.html"><span
lang=EN-US><span lang=EN-US>更强大的防攻击（访问速度限制）模块</span></span></a></span>； </p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span><a
href="http://tengine.taobao.org/document_cn/commandline_cn.html"><span
lang=EN-US><span lang=EN-US>更方便的命令行参数，如列出编译的模块列表、支持的指令等</span></span></a></span>；
</p>

<p class=MsoNormal><span lang=EN-US style='font-family:Symbol;mso-ascii-font-family:
宋体'>·</span><span lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span>可以根据访问文件类型设置过期时间；</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>功能特性很多，下面列出几个比较重要的特性进行说明</p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.5.1<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]>进程设置优化</h3>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:0cm;mso-char-indent-count:
0'><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_62" o:spid="_x0000_i1033"
 type="#_x0000_t75" style='width:408.75pt;height:255pt;visibility:visible;
 mso-wrap-style:square'>
 <v:imagedata src="nginx/image059.png" o:title=""/>
</v:shape></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.5.2<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span></span>动态加载</h3>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_41"
 o:spid="_x0000_i1032" type="#_x0000_t75" style='width:402pt;height:160.5pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image060.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://tengine.taobao.org/document_cn/dso_cn.html">http://tengine.taobao.org/document_cn/dso_cn.html</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.5.3<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US>session stick</span>负责均衡</h3>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_37"
 o:spid="_x0000_i1031" type="#_x0000_t75" style='width:415.5pt;height:161.25pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image061.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://tengine.taobao.org/document_cn/http_upstream_session_sticky_cn.html">http://tengine.taobao.org/document_cn/http_upstream_session_sticky_cn.html</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.5.4<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span></span>同时请求多个文件</h3>

<p class=MsoNormal>减少<span lang=EN-US>http</span>请求</p>

<p class=MsoNormal><span lang=EN-US>ngx_http_concat_module</span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>该模块类似于<span
lang=EN-US>apache</span>中的<span lang=EN-US>mod_concat</span>模块，用于合并多个文件在一个响应报文中。</p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>请求参数需要用两个问号（<span
lang=EN-US>'??'</span>）例如：</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>http://example.com/??style1.css,style2.css,foo/style3.css<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'>参数中某位置只包含一个<span
lang=EN-US>‘?’</span>，则<span lang=EN-US>'?'</span>后表示文件的版本，例如：</p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>http://example.com/??style1.css,style2.css,foo/style3.css?v=102234<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:12.0pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
/static/css/ {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>concat on;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>concat_max_files 20;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location
/static/js/ {<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>concat on;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>concat_max_files 30;<o:p></o:p></span></p>

<p class=MsoNormal style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
lang=EN-US style='background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<h3><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>5.5.5<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp;</span></span>系统过载保护</h3>

<p class=MsoNormal>模块默认没有编译，需要在编译时打开该模块<span lang=EN-US>: ./configure
--with-http_sysguard_module</span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_42"
 o:spid="_x0000_i1030" type="#_x0000_t75" style='width:415.5pt;height:240pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image062.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://tengine.taobao.org/document_cn/http_sysguard_cn.html">http://tengine.taobao.org/document_cn/http_sysguard_cn.html</a></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h1><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>6<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]>案例</h1>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>6.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>线上服务配置参考</span></h2>

<p class=MsoNormal><span lang=EN-US>nginx</span>做前端服务<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span>keepalived</span>做双机热备</p>

<p class=MsoNormal><span lang=EN-US>tomcat</span>做应用服务器<span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp; </span>N+1</span>热备，其中两台是老机器，四台新机器（其中运行了两个服务）</p>

<p class=MsoNormal><span lang=EN-US>memcached</span>做<span lang=EN-US>tomcatsession</span>管理<span
lang=EN-US><span style='mso-spacerun:yes'>&nbsp; </span></span></p>

<p class=MsoNormal><span lang=EN-US>allinpay.com<span
style='mso-spacerun:yes'>&nbsp; </span>http</span>服务</p>

<p class=MsoNormal><span lang=EN-US>tlb.com<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>提供<span lang=EN-US>https</span>服务</p>

<p style='margin:0cm;margin-bottom:.0001pt'><span lang=EN-US><span
style='mso-spacerun:yes'>&nbsp;</span></span></p>

<p style='margin:0cm;margin-bottom:.0001pt'>下面分三个文件进行配置</p>

<p style='margin:0cm;margin-bottom:.0001pt'><span lang=EN-US>nginx.conf</span></p>

<p style='margin:0cm;margin-bottom:.0001pt'><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>user<span
style='mso-spacerun:yes'>&nbsp; </span>nginx;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>单独用户<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>worker_processes<span
style='mso-spacerun:yes'>&nbsp; </span>1;#</span><span style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>处理器内核数目<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>worker_rlimit_nofile<span
style='mso-spacerun:yes'>&nbsp; </span>65535;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>最大资源<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>error_log<span
style='mso-spacerun:yes'>&nbsp; </span>/var/log/nginx/error.log warn;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>pid<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/var/run/nginx.pid;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>events {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>worker_connections<span
style='mso-spacerun:yes'>&nbsp; </span>65535;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>use epoll;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>http {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>include<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/etc/nginx/mime.types;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>default_type<span
style='mso-spacerun:yes'>&nbsp; </span>application/octet-stream;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>log_format<span
style='mso-spacerun:yes'>&nbsp; </span>main<span
style='mso-spacerun:yes'>&nbsp; </span>'$remote_addr - $remote_user
[$time_local] &quot;$request&quot; '<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>'$status $body_bytes_sent &quot;$http_referer&quot; '<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>'&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>access_log<span
style='mso-spacerun:yes'>&nbsp; </span>/var/log/nginx/access.log<span
style='mso-spacerun:yes'>&nbsp; </span>main;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#sendfile<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>on;<span style='mso-spacerun:yes'>&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>一般不要打开<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#tcp_nopush<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp; </span>on;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>keepalive_timeout<span
style='mso-spacerun:yes'>&nbsp; </span>65;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>gzip<span
style='mso-spacerun:yes'>&nbsp; </span>on;<span style='mso-spacerun:yes'>&nbsp;
</span># api</span><span style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>服务不需要打开<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>include
/etc/nginx/conf.d/*.conf;<span style='mso-spacerun:yes'>&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>包括指令<span lang=EN-US>, </span>包括下面的两个文件<span
lang=EN-US> allinpay.com.conf</span>和<span lang=EN-US>tlb.com.conf<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:14.0pt;font-family:"微软雅黑","sans-serif"'>allinpay.com.conf<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>新机器做主服务器，轮询方式，旧机器做备机<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>upstream backend_allinpay
{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;</span>server<span
style='mso-spacerun:yes'>&nbsp; </span>192.168.1.2:8080 ;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:3.75pt;mso-char-indent-count:.5'><span
lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:
#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>server<span
style='mso-spacerun:yes'>&nbsp; </span>192.168.1.3:8080 ;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;</span>server<span
style='mso-spacerun:yes'>&nbsp; </span>192.168.1.1:8080 backup;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>定义缓存<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache_path<span
style='mso-spacerun:yes'>&nbsp; </span>/data/nginx/allinpay levels=1:2 keys_zone=
allinpay:200m; inactive=10d max_size=1g;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_temp_path<span
style='mso-spacerun:yes'>&nbsp; </span>/data/nginx/temp;<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>只能定义一个<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>server {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>listen<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>80;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server_name<span
style='mso-spacerun:yes'>&nbsp; </span>allinpay.com;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>charset utf-8;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>access_log<span
style='mso-spacerun:yes'>&nbsp; </span>/var/log/nginx/log/$host/access.log<span
style='mso-spacerun:yes'>&nbsp; </span>main;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>location / {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_pass<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>http://backend_ allinpay;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>#</span><span style='font-size:
7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>客户端的地址<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>Host<span
style='mso-spacerun:yes'>&nbsp; </span>$host;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>X-Real-IP<span
style='mso-spacerun:yes'>&nbsp; </span>$remote_addr;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header X-Forward-For $proxy_add_x_forwarded_for<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>代理经过的地址<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location =
/status {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>stub_status on;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>access_log off;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>allow 127.0.0.1;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>deny
all;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>静态资源从后端取，然后放在缓存中<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location ~
\.(htm|html|gif|jpg|jpeg|png|bmp|ico|css|js|txt)$ {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#root<span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>/usr/share/nginx/html;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_pass<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>http://backend_ allinpay;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>客户端的地址<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>Host<span
style='mso-spacerun:yes'>&nbsp; </span>$host;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>X-Real-IP<span
style='mso-spacerun:yes'>&nbsp; </span>$remote_addr;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header X-Forward-For $proxy_add_x_forwarded_for<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>代理经过的地址<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>add_header AllInpay-Cache
&quot;$upstream_cache_status&quot;;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>缓存<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_cache allinpay;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>对不同的<span lang=EN-US>HTTP</span>状态码设置不同的缓存时间<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_cache_valid 200 304 3d;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>以域名、<span lang=EN-US>URI</span>组合成<span
lang=EN-US>Web</span>缓存的<span lang=EN-US>Key</span>值，<span lang=EN-US>Nginx</span>根据<span
lang=EN-US>Key</span>值哈希，存储缓存内容到二级缓存目录内<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_cache_key $host$uri;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span># </span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>客户端缓存<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>expires 2d;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:15.0pt;font-family:"微软雅黑","sans-serif"'>tlb.com.conf<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>新旧机器做主服务器，轮询方式，旧机器压力占系统的<span
lang=EN-US>1/6<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>upstream backend_tlb
{<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;</span>server<span
style='mso-spacerun:yes'>&nbsp; </span>192.168.2.2:8080 <span
style='mso-spacerun:yes'>&nbsp;&nbsp;</span>weight 5;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:3.75pt;mso-char-indent-count:.5'><span
lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:
#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>server<span
style='mso-spacerun:yes'>&nbsp; </span>192.168.2.3:8080 <span
style='mso-spacerun:yes'>&nbsp;</span>weight 5;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;</span>server<span
style='mso-spacerun:yes'>&nbsp; </span>192.168.2.1:8080 <span
style='mso-spacerun:yes'>&nbsp;</span>weight 2<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>proxy_cache_path<span
style='mso-spacerun:yes'>&nbsp; </span>/data/nginx/tlb_cache levels=1:2 keys_zone=tlb:100m;
inactive=10d max_size=200m;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>server {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>listen<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>443 ssl;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>server_name<span
style='mso-spacerun:yes'>&nbsp; </span>tlb.com www.tlb.com;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>ssl_certificate<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>/etc/nginx/conf.d/tlb/tlb.crt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>ssl_certificate_key<span
style='mso-spacerun:yes'>&nbsp; </span>/etc/nginx/conf.d/tlb/tlb.key;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>charset utf-8;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>source_charset utf-8;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>access_log<span
style='mso-spacerun:yes'>&nbsp; </span>/var/log/nginx/log/$host/access.log<span
style='mso-spacerun:yes'>&nbsp; </span>main;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>location / {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_pass<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>http://backend_tlb;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>客户端的地址<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>X-Real-IP<span
style='mso-spacerun:yes'>&nbsp; </span>$remote_addr;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location =
/status {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>stub_status on;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>access_log off;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>allow 127.0.0.1;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>deny
all;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>静态资源从后端取，然后放在缓存中<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>location ~
\.(htm|html|gif|jpg|jpeg|png|bmp|ico|css|js|txt)$ {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_pass<span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>http://backend_tlb;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>客户端的地址<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>Host<span
style='mso-spacerun:yes'>&nbsp; </span>$host;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header<span
style='mso-spacerun:yes'>&nbsp; </span>X-Real-IP<span
style='mso-spacerun:yes'>&nbsp; </span>$remote_addr;<o:p></o:p></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>proxy_set_header X-Forward-For $proxy_add_x_forwarded_for<span
style='mso-spacerun:yes'>&nbsp; </span>#</span><span style='font-size:7.5pt;
font-family:"微软雅黑","sans-serif";background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>代理经过的地址<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='text-indent:15.0pt'><span lang=EN-US
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>add_header TLB-Cache
&quot;$upstream_cache_status&quot;;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>缓存<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_cache tlb_cache;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>对不同的<span lang=EN-US>HTTP</span>状态码设置不同的缓存时间<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_cache_valid 200 304 5d;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>#</span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>以域名、<span lang=EN-US>URI</span>组合成<span
lang=EN-US>Web</span>缓存的<span lang=EN-US>Key</span>值，<span lang=EN-US>Nginx</span>根据<span
lang=EN-US>Key</span>值哈希，存储缓存内容到二级缓存目录内<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>proxy_cache_key $host$uri;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span># </span><span
style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";background:#D9D9D9;
mso-shading:white;mso-pattern:gray-15 auto'>客户端缓存<span lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span>expires 1d;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><span
style='mso-spacerun:yes'>&nbsp; </span>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>}<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'>内核优化<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal style='background:white'><span lang=EN-US>vi
/etc/sysctl.conf </span></p>

<p class=MsoNormal style='background:white'>在末尾增加以下内容：</p>

<p class=MsoNormal>引用</p>

<p class=MsoNormal><span lang=EN-US style='background:#D9D9D9;mso-shading:white;
mso-pattern:gray-15 auto'>net.ipv4.tcp_fin_timeout = 30<br>
net.ipv4.tcp_keepalive_time = 300<br>
net.ipv4.tcp_syncookies = 1<br>
net.ipv4.tcp_tw_reuse = 1<br>
net.ipv4.tcp_tw_recycle = 1<br>
net.ipv4.ip_local_port_range = 5000&nbsp;&nbsp;&nbsp;&nbsp;65000<o:p></o:p></span></p>

<p class=MsoNormal>使配置立即生效：</p>

<p class=MsoNormal style='background:white'><span lang=EN-US>/sbin/sysctl -p</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:7.5pt;font-family:"微软雅黑","sans-serif";
background:#D9D9D9;mso-shading:white;mso-pattern:gray-15 auto'><o:p>&nbsp;</o:p></span></p>

<h1><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>7<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]>常见问题</h1>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>7.1<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:宋体;mso-ascii-font-family:
Cambria;mso-ascii-theme-font:major-latin;mso-fareast-font-family:宋体;mso-fareast-theme-font:
major-fareast;mso-hansi-font-family:Cambria;mso-hansi-theme-font:major-latin'>启动错误</span></h2>

<p class=MsoListParagraph style='margin-left:18.0pt;text-indent:-18.0pt;
mso-char-indent-count:0;mso-list:l17 level1 lfo11'><![if !supportLists]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-list:Ignore'>1.<span style='font:7.0pt "Times New Roman"'>&nbsp; </span></span></span><![endif]><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt'><span
style='mso-spacerun:yes'>&nbsp;</span></span><span style='font-size:10.5pt;
mso-bidi-font-size:12.0pt'>漏了<span lang=EN-US>;<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>nginx: [emerg] directive &quot;server_name&quot; is not terminated by
&quot;;&quot; in D:\nginx-1.1.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>2/conf/nginx.conf:149<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>2.</span><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>参数错误，请检测拼写<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'>nginx: [emerg] invalid parameter &quot;eight=10&quot; in
D:\nginx-1.1.2/conf/nginx.conf:37<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:
12.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>解决思路：注意查看日志，打开调试开关<span
lang=EN-US><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US>invalid number of arguments in
&quot;root&quot; directive</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:22.0pt;mso-font-kerning:
22.0pt;mso-no-proof:yes'><v:shape id="图片_x0020_1" o:spid="_x0000_i1029" type="#_x0000_t75"
 style='width:262.5pt;height:50.25pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image063.png" o:title=""/>
</v:shape></span><span class=1Char><span lang=EN-US style='font-size:22.0pt'><o:p></o:p></span></span></p>

<p class=MsoNormal><span class=1Char><span style='font-size:22.0pt'>修改为<span
lang=EN-US><o:p></o:p></span></span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:22.0pt;mso-font-kerning:
22.0pt;mso-no-proof:yes'><v:shape id="图片_x0020_4" o:spid="_x0000_i1028" type="#_x0000_t75"
 style='width:285pt;height:57.75pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image064.png" o:title=""/>
</v:shape></span><span class=1Char><span lang=EN-US style='font-size:22.0pt'><o:p></o:p></span></span></p>

<p class=MsoNormal>查看日志</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_28"
 o:spid="_x0000_i1027" type="#_x0000_t75" style='width:415.5pt;height:75pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image065.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_29"
 o:spid="_x0000_i1026" type="#_x0000_t75" style='width:415.5pt;height:111pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image066.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<h2><![if !supportLists]><span lang=EN-US style='mso-fareast-font-family:Cambria;
mso-fareast-theme-font:major-latin;mso-bidi-font-family:Cambria;mso-bidi-theme-font:
major-latin'><span style='mso-list:Ignore'>7.2<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span lang=EN-US>nginx</span><span
style='font-family:宋体;mso-ascii-font-family:Cambria;mso-ascii-theme-font:major-latin;
mso-fareast-font-family:宋体;mso-fareast-theme-font:major-fareast;mso-hansi-font-family:
Cambria;mso-hansi-theme-font:major-latin'>无法访问</span></h2>

<p class=MsoNormal>启动正常，本机可以访问。</p>

<p class=MsoNormal>远程无法访问。 </p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-no-proof:yes'><v:shape id="图片_x0020_57"
 o:spid="_x0000_i1025" type="#_x0000_t75" style='width:415.5pt;height:92.25pt;
 visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="nginx/image067.png" o:title=""/>
</v:shape></span></p>

<p class=MsoNormal>一般是防火墙问题。</p>

<p class=MsoNormal><span lang=EN-US>service iptables stop</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<pre><span class=pln><span lang=EN-US>vi </span></span><span class=pun><span
lang=EN-US>/</span></span><span class=pln><span lang=EN-US>etc</span></span><span
class=pun><span lang=EN-US>/</span></span><span class=pln><span lang=EN-US>sysconfig</span></span><span
class=pun><span lang=EN-US>/</span></span><span class=pln><span lang=EN-US>iptables</span></span></pre>

<p class=MsoNormal>添加</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<pre><span class=pun><span lang=EN-US>-</span></span><span class=pln><span
lang=EN-US>A </span></span><span class=pun><span lang=EN-US>-</span></span><span
class=pln><span lang=EN-US>INPUT </span></span><span class=pun><span
lang=EN-US>-</span></span><span class=pln><span lang=EN-US>m state </span></span><span
class=pun><span lang=EN-US>--</span></span><span class=pln><span lang=EN-US>state NEW </span></span><span
class=pun><span lang=EN-US>-</span></span><span class=pln><span lang=EN-US>m tcp </span></span><span
class=pun><span lang=EN-US>-</span></span><span class=pln><span lang=EN-US>p tcp </span></span><span
class=pun><span lang=EN-US>--</span></span><span class=pln><span lang=EN-US>dport </span></span><span
class=lit><span lang=EN-US>80</span></span><span class=pln><span lang=EN-US> </span></span><span
class=pun><span lang=EN-US>-</span></span><span class=pln><span lang=EN-US>j ACCEPT</span></span></pre>

<p class=MsoNormal>然后执行 </p>

<p class=MsoNormal><span lang=EN-US>service iptables restart</span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>注意：相关端口还有<span lang=EN-US>443</span>等。 </p>

<h1><![if !supportLists]><span lang=EN-US><span style='mso-list:Ignore'>8<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp; </span></span></span><![endif]>参考资料</h1>

<p class=MsoNormal><span lang=EN-US><a
href="http://www.ibm.com/developerworks/cn/web/wa-lo-nginx/">http://www.ibm.com/developerworks/cn/web/wa-lo-nginx/</a><span
class=MsoHyperlink><span style='mso-spacerun:yes'>&nbsp; </span></span></span><span
class=MsoHyperlink>入门</span> </p>

<p class=MsoNormal><span lang=EN-US><a href="http://nginx.org/">http://nginx.org/</a><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span></span>官网</p>

<p class=MsoNormal><span lang=EN-US><a
href="http://nginx.org/en/docs/index.html">http://nginx.org/en/docs/index.html</a><span
style='mso-spacerun:yes'>&nbsp; </span></span>配置</p>

<p class=MsoNormal><span lang=EN-US><a href="http://nginx.org/cn/docs/">http://nginx.org/cn/docs/</a><span
style='mso-spacerun:yes'>&nbsp;&nbsp;&nbsp; </span></span>中文文档</p>

<p class=MsoNormal><span lang=EN-US><a href="http://tengine.taobao.org/">http://tengine.taobao.org/</a><span
style='mso-spacerun:yes'>&nbsp; </span></span>淘宝修改的<span lang=EN-US>nginx</span></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://tengine.taobao.org/book/index.html">http://tengine.taobao.org/book/index.html</a><span
style='mso-spacerun:yes'>&nbsp; </span>tengine</span>开发文档</p>

<p class=MsoNormal><span lang=EN-US><a href="http://wiki.nginx.org/Modules">http://wiki.nginx.org/Modules</a>
</span><span class=1Char><span lang=EN-US style='font-size:22.0pt'><o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US><a href="http://wiki.nginx.org/NginxChs"><span
style='font-size:10.5pt;mso-bidi-font-size:12.0pt'>http://wiki.nginx.org/NginxChs</span></a></span><u><span
lang=EN-US style='font-size:10.5pt;mso-bidi-font-size:12.0pt;color:blue'><o:p></o:p></span></u></p>

<p class=MsoNormal><span lang=EN-US><a
href="http://os.51cto.com/art/201111/304611.htm">http://os.51cto.com/art/201111/304611.htm</a><span
style='mso-spacerun:yes'>&nbsp;&nbsp; </span>nginx</span>专题</p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US><o:p>&nbsp;</o:p></span></p>

</div>

</body>

</html>
