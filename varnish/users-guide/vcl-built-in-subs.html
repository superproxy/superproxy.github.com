<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Built in subroutines &mdash; varnish 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="varnish 1.0.1 documentation" href="../index.html" />
    <link rel="up" title="VCL - Varnish Configuration Language" href="vcl.html" />
    <link rel="next" title="Request and response VCL objects" href="vcl-variables.html" />
    <link rel="prev" title="VCL Syntax" href="vcl-syntax.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="vcl-variables.html" title="Request and response VCL objects"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="vcl-syntax.html" title="VCL Syntax"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">varnish 1.0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >The Varnish Users Guide</a> &raquo;</li>
          <li><a href="vcl.html" accesskey="U">VCL - Varnish Configuration Language</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="vcl-built-in-subs"></span><div class="section" id="built-in-subroutines">
<h1>Built in subroutines<a class="headerlink" href="#built-in-subroutines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="vcl-recv">
<h2>vcl_recv<a class="headerlink" href="#vcl-recv" title="Permalink to this headline">¶</a></h2>
<p>Called at the beginning of a request, after the complete request has
been received and parsed. Its purpose is to decide whether or not to
serve the request, how to do it, and, if applicable, which backend to
use.</p>
<p>It is also used to modify the request, something you&#8217;ll probably find
yourself doing frequently.</p>
<p>The <cite>vcl_recv</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> on one
of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>synth(status code, reason)</dt>
<dd>Return a synthetic object with the specified status code to the
client and abandon the request.</dd>
<dt>pass</dt>
<dd>Switch to pass mode. Control will eventually pass to vcl_pass.</dd>
<dt>pipe</dt>
<dd>Switch to pipe mode. Control will eventually pass to vcl_pipe.</dd>
<dt>hash</dt>
<dd>Continue processing the object as a potential candidate for
caching. Passes the control over to vcl_hash.</dd>
<dt>purge</dt>
<dd>Purge the object and it&#8217;s variants. Control passes through
vcl_hash to vcl_purge.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-pipe">
<h2>vcl_pipe<a class="headerlink" href="#vcl-pipe" title="Permalink to this headline">¶</a></h2>
<p>Called upon entering pipe mode. In this mode, the request is passed
on to the backend, and any further data from either client or backend
is passed on unaltered until either end closes the
connection. Basically, Varnish will degrade into a simple TCP proxy,
shuffling bytes back and forth.</p>
<p>The <cite>vcl_pipe</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> with one
of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>synth(status code, reason)</dt>
<dd>Return the specified status code to the client and abandon the request.</dd>
<dt>pipe</dt>
<dd>Proceed with pipe mode.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-pass">
<h2>vcl_pass<a class="headerlink" href="#vcl-pass" title="Permalink to this headline">¶</a></h2>
<p>Called upon entering pass mode. In this mode, the request is passed
on to the backend, and the backend&#8217;s response is passed on to the
client, but is not entered into the cache. Subsequent requests
submitted over the same client connection are handled normally.</p>
<p>The <cite>vcl_pass</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> with one
of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>synth(status code, reason)</dt>
<dd>Return the specified status code to the client and abandon the request.</dd>
<dt>pass</dt>
<dd>Proceed with pass mode.</dd>
<dt>restart</dt>
<dd>Restart the transaction. Increases the restart counter. If the number
of restarts is higher than <em>max_restarts</em> Varnish emits a guru meditation
error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-hit">
<h2>vcl_hit<a class="headerlink" href="#vcl-hit" title="Permalink to this headline">¶</a></h2>
<p>Called when a cache lookup is successful.</p>
<p>The <cite>vcl_hit</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> with one of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>restart</dt>
<dd>Restart the transaction. Increases the restart counter. If the number
of restarts is higher than <em>max_restarts</em> Varnish emits a guru meditation
error.</dd>
<dt>deliver</dt>
<dd>Deliver the object. Control passes to <cite>vcl_deliver</cite>.</dd>
<dt>synth(status code, reason)</dt>
<dd>Return the specified status code to the client and abandon the request.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-miss">
<h2>vcl_miss<a class="headerlink" href="#vcl-miss" title="Permalink to this headline">¶</a></h2>
<p>Called after a cache lookup if the requested document was not found in
the cache. Its purpose is to decide whether or not to attempt to
retrieve the document from the backend, and which backend to use.</p>
<p>The <cite>vcl_miss</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> with one
of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>synth(status code, reason)</dt>
<dd>Return the specified status code to the client and abandon the request.</dd>
<dt>pass</dt>
<dd>Switch to pass mode. Control will eventually pass to <cite>vcl_pass</cite>.</dd>
<dt>fetch</dt>
<dd>Retrieve the requested object from the backend. Control will
eventually pass to <cite>vcl_backend_fetch</cite>.</dd>
<dt>restart</dt>
<dd>Restart the transaction. Increases the restart counter. If the number
of restarts is higher than <em>max_restarts</em> Varnish emits a guru meditation
error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-hash">
<h2>vcl_hash<a class="headerlink" href="#vcl-hash" title="Permalink to this headline">¶</a></h2>
<p>Called after <cite>vcl_recv</cite> to create a hash value for the request. This is
used as a key to look up the object in Varnish.</p>
<p>The <cite>vcl_hash</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> with one
of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>lookup</dt>
<dd>Look up the object in cache. Control passes to vcl_miss, vcl_hit
or vcl_purge.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-purge">
<h2>vcl_purge<a class="headerlink" href="#vcl-purge" title="Permalink to this headline">¶</a></h2>
<p>Called after the purge has been executed and all its variants have been evited.</p>
<p>The <cite>vcl_purge</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> with one
of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>synth</dt>
<dd>Produce a response.</dd>
<dt>restart</dt>
<dd>Restart the transaction. Increases the restart counter. If the number
of restarts is higher than <em>max_restarts</em> Varnish emits a guru meditation
error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-deliver">
<h2>vcl_deliver<a class="headerlink" href="#vcl-deliver" title="Permalink to this headline">¶</a></h2>
<p>Called before a cached object is delivered to the client.</p>
<p>The <cite>vcl_deliver</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt> with one
of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>deliver</dt>
<dd>Deliver the object to the client.</dd>
<dt>restart</dt>
<dd>Restart the transaction. Increases the restart counter. If the number
of restarts is higher than <em>max_restarts</em> Varnish emits a guru meditation
error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-backend-fetch">
<h2>vcl_backend_fetch<a class="headerlink" href="#vcl-backend-fetch" title="Permalink to this headline">¶</a></h2>
<p>Called before sending the backend request. In this subroutine you
typically alter the request before it gets to the backend.</p>
<p>The <cite>vcl_backend_fetch</cite> subroutine may terminate with calling
<tt class="docutils literal"><span class="pre">return()</span></tt> with one of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>fetch</dt>
<dd>Fetch the object from the backend.</dd>
<dt>abandon</dt>
<dd>Abandon the backend request and generates an error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-backend-response">
<h2>vcl_backend_response<a class="headerlink" href="#vcl-backend-response" title="Permalink to this headline">¶</a></h2>
<p>Called after the response headers has been successfully retrieved from
the backend.</p>
<p>The <cite>vcl_backend_response</cite> subroutine may terminate with calling
<tt class="docutils literal"><span class="pre">return()</span></tt> with one of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>deliver</dt>
<dd>Possibly insert the object into the cache, then deliver it to the
Control will eventually pass to <cite>vcl_deliver</cite>.</dd>
<dt>abandon</dt>
<dd>Abandon the backend request and generates an error.</dd>
<dt>retry</dt>
<dd>Retry the backend transaction. Increases the <cite>retries</cite> counter.
If the number of retries is higher than <em>max_retries</em> Varnish
emits a guru meditation error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-backend-error">
<h2>vcl_backend_error<a class="headerlink" href="#vcl-backend-error" title="Permalink to this headline">¶</a></h2>
<p>This subroutine is called if we fail the backend fetch.</p>
<p>The <cite>vcl_backend_error</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt>
with one of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>deliver</dt>
<dd>Deliver the error.</dd>
<dt>retry</dt>
<dd>Retry the backend transaction. Increases the <cite>retries</cite> counter. If
the number of retries is higher than <em>max_retries</em> Varnish emits a
guru meditation error.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-init">
<h2>vcl_init<a class="headerlink" href="#vcl-init" title="Permalink to this headline">¶</a></h2>
<p>Called when VCL is loaded, before any requests pass through it.
Typically used to initialize VMODs.</p>
<p>The <cite>vcl_init</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt>
with one of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>ok</dt>
<dd>Normal return, VCL continues loading.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="vcl-fini">
<h2>vcl_fini<a class="headerlink" href="#vcl-fini" title="Permalink to this headline">¶</a></h2>
<p>Called when VCL is discarded only after all requests have exited the VCL.
Typically used to clean up VMODs.</p>
<p>The <cite>vcl_fini</cite> subroutine may terminate with calling <tt class="docutils literal"><span class="pre">return()</span></tt>
with one of the following keywords:</p>
<blockquote>
<div><dl class="docutils">
<dt>ok</dt>
<dd>Normal return, VCL will be discarded.</dd>
</dl>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Built in subroutines</a><ul>
<li><a class="reference internal" href="#vcl-recv">vcl_recv</a></li>
<li><a class="reference internal" href="#vcl-pipe">vcl_pipe</a></li>
<li><a class="reference internal" href="#vcl-pass">vcl_pass</a></li>
<li><a class="reference internal" href="#vcl-hit">vcl_hit</a></li>
<li><a class="reference internal" href="#vcl-miss">vcl_miss</a></li>
<li><a class="reference internal" href="#vcl-hash">vcl_hash</a></li>
<li><a class="reference internal" href="#vcl-purge">vcl_purge</a></li>
<li><a class="reference internal" href="#vcl-deliver">vcl_deliver</a></li>
<li><a class="reference internal" href="#vcl-backend-fetch">vcl_backend_fetch</a></li>
<li><a class="reference internal" href="#vcl-backend-response">vcl_backend_response</a></li>
<li><a class="reference internal" href="#vcl-backend-error">vcl_backend_error</a></li>
<li><a class="reference internal" href="#vcl-init">vcl_init</a></li>
<li><a class="reference internal" href="#vcl-fini">vcl_fini</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="vcl-syntax.html"
                        title="previous chapter">VCL Syntax</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="vcl-variables.html"
                        title="next chapter">Request and response VCL objects</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/users-guide/vcl-built-in-subs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="vcl-variables.html" title="Request and response VCL objects"
             >next</a> |</li>
        <li class="right" >
          <a href="vcl-syntax.html" title="VCL Syntax"
             >previous</a> |</li>
        <li><a href="../index.html">varnish 1.0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >The Varnish Users Guide</a> &raquo;</li>
          <li><a href="vcl.html" >VCL - Varnish Configuration Language</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, sens.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>